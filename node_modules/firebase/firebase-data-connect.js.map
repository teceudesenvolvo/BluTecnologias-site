{"version":3,"file":"firebase-data-connect.js","sources":["../util/src/url.ts","../util/src/emulator.ts","../util/src/errors.ts","../component/src/component.ts","../logger/src/logger.ts","../data-connect/src/core/version.ts","../data-connect/src/core/error.ts","../data-connect/src/cache/EntityDataObject.ts","../data-connect/src/cache/InMemoryCacheProvider.ts","../data-connect/src/cache/EntityNode.ts","../data-connect/src/cache/ResultTree.ts","../data-connect/src/cache/ImpactedQueryRefsAccumulator.ts","../data-connect/src/cache/ResultTreeProcessor.ts","../data-connect/src/cache/Cache.ts","../util/src/sha256.ts","../data-connect/src/core/AppCheckTokenProvider.ts","../data-connect/src/logger.ts","../data-connect/src/core/FirebaseAuthProvider.ts","../data-connect/src/api/Reference.ts","../data-connect/src/cache/cacheUtils.ts","../data-connect/src/util/encoder.ts","../data-connect/src/core/query/QueryManager.ts","../data-connect/src/network/transport/index.ts","../data-connect/src/util/url.ts","../data-connect/src/network/fetch.ts","../data-connect/src/network/transport/rest.ts","../data-connect/src/api/Mutation.ts","../data-connect/src/api/DataConnect.ts","../data-connect/src/core/query/queryOptions.ts","../data-connect/src/api/query.ts","../data-connect/src/util/validateArgs.ts","../data-connect/src/core/query/subscribe.ts","../data-connect/src/register.ts","../data-connect/src/index.ts"],"sourcesContent":["/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * Checks whether host is a cloud workstation or not.\n * @public\n */\nexport function isCloudWorkstation(url: string): boolean {\n  // `isCloudWorkstation` is called without protocol in certain connect*Emulator functions\n  // In HTTP request builders, it's called with the protocol.\n  // If called with protocol prefix, it's a valid URL, so we extract the hostname\n  // If called without, we assume the string is the hostname.\n  try {\n    const host =\n      url.startsWith('http://') || url.startsWith('https://')\n        ? new URL(url).hostname\n        : url;\n    return host.endsWith('.cloudworkstations.dev');\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Makes a fetch request to the given server.\n * Mostly used for forwarding cookies in Firebase Studio.\n * @public\n */\nexport async function pingServer(endpoint: string): Promise<boolean> {\n  const result = await fetch(endpoint, {\n    credentials: 'include'\n  });\n  return result.ok;\n}\n","/**\n * @license\n * Copyright 2021 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { base64urlEncodeWithoutPadding } from './crypt';\nimport { isCloudWorkstation } from './url';\n\n// Firebase Auth tokens contain snake_case claims following the JWT standard / convention.\n/* eslint-disable camelcase */\n\nexport type FirebaseSignInProvider =\n  | 'custom'\n  | 'email'\n  | 'password'\n  | 'phone'\n  | 'anonymous'\n  | 'google.com'\n  | 'facebook.com'\n  | 'github.com'\n  | 'twitter.com'\n  | 'microsoft.com'\n  | 'apple.com';\n\ninterface FirebaseIdToken {\n  // Always set to https://securetoken.google.com/PROJECT_ID\n  iss: string;\n\n  // Always set to PROJECT_ID\n  aud: string;\n\n  // The user's unique ID\n  sub: string;\n\n  // The token issue time, in seconds since epoch\n  iat: number;\n\n  // The token expiry time, normally 'iat' + 3600\n  exp: number;\n\n  // The user's unique ID. Must be equal to 'sub'\n  user_id: string;\n\n  // The time the user authenticated, normally 'iat'\n  auth_time: number;\n\n  // The sign in provider, only set when the provider is 'anonymous'\n  provider_id?: 'anonymous';\n\n  // The user's primary email\n  email?: string;\n\n  // The user's email verification status\n  email_verified?: boolean;\n\n  // The user's primary phone number\n  phone_number?: string;\n\n  // The user's display name\n  name?: string;\n\n  // The user's profile photo URL\n  picture?: string;\n\n  // Information on all identities linked to this user\n  firebase: {\n    // The primary sign-in provider\n    sign_in_provider: FirebaseSignInProvider;\n\n    // A map of providers to the user's list of unique identifiers from\n    // each provider\n    identities?: { [provider in FirebaseSignInProvider]?: string[] };\n  };\n\n  // Custom claims set by the developer\n  [claim: string]: unknown;\n\n  uid?: never; // Try to catch a common mistake of \"uid\" (should be \"sub\" instead).\n}\n\nexport type EmulatorMockTokenOptions = ({ user_id: string } | { sub: string }) &\n  Partial<FirebaseIdToken>;\n\nexport function createMockUserToken(\n  token: EmulatorMockTokenOptions,\n  projectId?: string\n): string {\n  if (token.uid) {\n    throw new Error(\n      'The \"uid\" field is no longer supported by mockUserToken. Please use \"sub\" instead for Firebase Auth User ID.'\n    );\n  }\n  // Unsecured JWTs use \"none\" as the algorithm.\n  const header = {\n    alg: 'none',\n    type: 'JWT'\n  };\n\n  const project = projectId || 'demo-project';\n  const iat = token.iat || 0;\n  const sub = token.sub || token.user_id;\n  if (!sub) {\n    throw new Error(\"mockUserToken must contain 'sub' or 'user_id' field!\");\n  }\n\n  const payload: FirebaseIdToken = {\n    // Set all required fields to decent defaults\n    iss: `https://securetoken.google.com/${project}`,\n    aud: project,\n    iat,\n    exp: iat + 3600,\n    auth_time: iat,\n    sub,\n    user_id: sub,\n    firebase: {\n      sign_in_provider: 'custom',\n      identities: {}\n    },\n\n    // Override with user options\n    ...token\n  };\n\n  // Unsecured JWTs use the empty string as a signature.\n  const signature = '';\n  return [\n    base64urlEncodeWithoutPadding(JSON.stringify(header)),\n    base64urlEncodeWithoutPadding(JSON.stringify(payload)),\n    signature\n  ].join('.');\n}\n\ninterface EmulatorStatusMap {\n  [name: string]: boolean;\n}\nconst emulatorStatus: EmulatorStatusMap = {};\n\ninterface EmulatorSummary {\n  prod: string[];\n  emulator: string[];\n}\n\n// Checks whether any products are running on an emulator\nfunction getEmulatorSummary(): EmulatorSummary {\n  const summary: EmulatorSummary = {\n    prod: [],\n    emulator: []\n  };\n  for (const key of Object.keys(emulatorStatus)) {\n    if (emulatorStatus[key]) {\n      summary.emulator.push(key);\n    } else {\n      summary.prod.push(key);\n    }\n  }\n  return summary;\n}\n\nfunction getOrCreateEl(id: string): { created: boolean; element: HTMLElement } {\n  let parentDiv = document.getElementById(id);\n  let created = false;\n  if (!parentDiv) {\n    parentDiv = document.createElement('div');\n    parentDiv.setAttribute('id', id);\n    created = true;\n  }\n  return { created, element: parentDiv };\n}\n\nlet previouslyDismissed = false;\n/**\n * Updates Emulator Banner. Primarily used for Firebase Studio\n * @param name\n * @param isRunningEmulator\n * @public\n */\nexport function updateEmulatorBanner(\n  name: string,\n  isRunningEmulator: boolean\n): void {\n  if (\n    typeof window === 'undefined' ||\n    typeof document === 'undefined' ||\n    !isCloudWorkstation(window.location.host) ||\n    emulatorStatus[name] === isRunningEmulator ||\n    emulatorStatus[name] || // If already set to use emulator, can't go back to prod.\n    previouslyDismissed\n  ) {\n    return;\n  }\n\n  emulatorStatus[name] = isRunningEmulator;\n\n  function prefixedId(id: string): string {\n    return `__firebase__banner__${id}`;\n  }\n  const bannerId = '__firebase__banner';\n  const summary = getEmulatorSummary();\n  const showError = summary.prod.length > 0;\n\n  function tearDown(): void {\n    const element = document.getElementById(bannerId);\n    if (element) {\n      element.remove();\n    }\n  }\n\n  function setupBannerStyles(bannerEl: HTMLElement): void {\n    bannerEl.style.display = 'flex';\n    bannerEl.style.background = '#7faaf0';\n    bannerEl.style.position = 'fixed';\n    bannerEl.style.bottom = '5px';\n    bannerEl.style.left = '5px';\n    bannerEl.style.padding = '.5em';\n    bannerEl.style.borderRadius = '5px';\n    bannerEl.style.alignItems = 'center';\n  }\n\n  function setupIconStyles(prependIcon: SVGElement, iconId: string): void {\n    prependIcon.setAttribute('width', '24');\n    prependIcon.setAttribute('id', iconId);\n    prependIcon.setAttribute('height', '24');\n    prependIcon.setAttribute('viewBox', '0 0 24 24');\n    prependIcon.setAttribute('fill', 'none');\n    prependIcon.style.marginLeft = '-6px';\n  }\n\n  function setupCloseBtn(): HTMLSpanElement {\n    const closeBtn = document.createElement('span');\n    closeBtn.style.cursor = 'pointer';\n    closeBtn.style.marginLeft = '16px';\n    closeBtn.style.fontSize = '24px';\n    closeBtn.innerHTML = ' &times;';\n    closeBtn.onclick = () => {\n      previouslyDismissed = true;\n      tearDown();\n    };\n    return closeBtn;\n  }\n\n  function setupLinkStyles(\n    learnMoreLink: HTMLAnchorElement,\n    learnMoreId: string\n  ): void {\n    learnMoreLink.setAttribute('id', learnMoreId);\n    learnMoreLink.innerText = 'Learn more';\n    learnMoreLink.href =\n      'https://firebase.google.com/docs/studio/preview-apps#preview-backend';\n    learnMoreLink.setAttribute('target', '__blank');\n    learnMoreLink.style.paddingLeft = '5px';\n    learnMoreLink.style.textDecoration = 'underline';\n  }\n\n  function setupDom(): void {\n    const banner = getOrCreateEl(bannerId);\n    const firebaseTextId = prefixedId('text');\n    const firebaseText: HTMLSpanElement =\n      document.getElementById(firebaseTextId) || document.createElement('span');\n    const learnMoreId = prefixedId('learnmore');\n    const learnMoreLink: HTMLAnchorElement =\n      (document.getElementById(learnMoreId) as HTMLAnchorElement) ||\n      document.createElement('a');\n    const prependIconId = prefixedId('preprendIcon');\n    const prependIcon: SVGElement =\n      (document.getElementById(\n        prependIconId\n      ) as HTMLOrSVGElement as SVGElement) ||\n      document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n    if (banner.created) {\n      // update styles\n      const bannerEl = banner.element;\n      setupBannerStyles(bannerEl);\n      setupLinkStyles(learnMoreLink, learnMoreId);\n      const closeBtn = setupCloseBtn();\n      setupIconStyles(prependIcon, prependIconId);\n      bannerEl.append(prependIcon, firebaseText, learnMoreLink, closeBtn);\n      document.body.appendChild(bannerEl);\n    }\n\n    if (showError) {\n      firebaseText.innerText = `Preview backend disconnected.`;\n      prependIcon.innerHTML = `<g clip-path=\"url(#clip0_6013_33858)\">\n<path d=\"M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z\" fill=\"#212121\"/>\n</g>\n<defs>\n<clipPath id=\"clip0_6013_33858\">\n<rect width=\"24\" height=\"24\" fill=\"white\"/>\n</clipPath>\n</defs>`;\n    } else {\n      prependIcon.innerHTML = `<g clip-path=\"url(#clip0_6083_34804)\">\n<path d=\"M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z\" fill=\"#212121\"/>\n</g>\n<defs>\n<clipPath id=\"clip0_6083_34804\">\n<rect width=\"24\" height=\"24\" fill=\"white\"/>\n</clipPath>\n</defs>`;\n      firebaseText.innerText = 'Preview backend running in this workspace.';\n    }\n    firebaseText.setAttribute('id', firebaseTextId);\n  }\n  if (document.readyState === 'loading') {\n    window.addEventListener('DOMContentLoaded', setupDom);\n  } else {\n    setupDom();\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n/**\n * @fileoverview Standardized Firebase Error.\n *\n * Usage:\n *\n *   // TypeScript string literals for type-safe codes\n *   type Err =\n *     'unknown' |\n *     'object-not-found'\n *     ;\n *\n *   // Closure enum for type-safe error codes\n *   // at-enum {string}\n *   var Err = {\n *     UNKNOWN: 'unknown',\n *     OBJECT_NOT_FOUND: 'object-not-found',\n *   }\n *\n *   let errors: Map<Err, string> = {\n *     'generic-error': \"Unknown error\",\n *     'file-not-found': \"Could not find file: {$file}\",\n *   };\n *\n *   // Type-safe function - must pass a valid error code as param.\n *   let error = new ErrorFactory<Err>('service', 'Service', errors);\n *\n *   ...\n *   throw error.create(Err.GENERIC);\n *   ...\n *   throw error.create(Err.FILE_NOT_FOUND, {'file': fileName});\n *   ...\n *   // Service: Could not file file: foo.txt (service/file-not-found).\n *\n *   catch (e) {\n *     assert(e.message === \"Could not find file: foo.txt.\");\n *     if ((e as FirebaseError)?.code === 'service/file-not-found') {\n *       console.log(\"Could not read file: \" + e['file']);\n *     }\n *   }\n */\n\nexport type ErrorMap<ErrorCode extends string> = {\n  readonly [K in ErrorCode]: string;\n};\n\nconst ERROR_NAME = 'FirebaseError';\n\nexport interface StringLike {\n  toString(): string;\n}\n\nexport interface ErrorData {\n  [key: string]: unknown;\n}\n\n// Based on code from:\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#Custom_Error_Types\nexport class FirebaseError extends Error {\n  /** The custom name for all FirebaseErrors. */\n  readonly name: string = ERROR_NAME;\n\n  constructor(\n    /** The error code for this error. */\n    readonly code: string,\n    message: string,\n    /** Custom data for this error. */\n    public customData?: Record<string, unknown>\n  ) {\n    super(message);\n\n    // Fix For ES5\n    // https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n    // TODO(dlarocque): Replace this with `new.target`: https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-2.html#support-for-newtarget\n    //                   which we can now use since we no longer target ES5.\n    Object.setPrototypeOf(this, FirebaseError.prototype);\n\n    // Maintains proper stack trace for where our error was thrown.\n    // Only available on V8.\n    if (Error.captureStackTrace) {\n      Error.captureStackTrace(this, ErrorFactory.prototype.create);\n    }\n  }\n}\n\nexport class ErrorFactory<\n  ErrorCode extends string,\n  ErrorParams extends { readonly [K in ErrorCode]?: ErrorData } = {}\n> {\n  constructor(\n    private readonly service: string,\n    private readonly serviceName: string,\n    private readonly errors: ErrorMap<ErrorCode>\n  ) {}\n\n  create<K extends ErrorCode>(\n    code: K,\n    ...data: K extends keyof ErrorParams ? [ErrorParams[K]] : []\n  ): FirebaseError {\n    const customData = (data[0] as ErrorData) || {};\n    const fullCode = `${this.service}/${code}`;\n    const template = this.errors[code];\n\n    const message = template ? replaceTemplate(template, customData) : 'Error';\n    // Service Name: Error message (service/code).\n    const fullMessage = `${this.serviceName}: ${message} (${fullCode}).`;\n\n    const error = new FirebaseError(fullCode, fullMessage, customData);\n\n    return error;\n  }\n}\n\nfunction replaceTemplate(template: string, data: ErrorData): string {\n  return template.replace(PATTERN, (_, key) => {\n    const value = data[key];\n    return value != null ? String(value) : `<${key}?>`;\n  });\n}\n\nconst PATTERN = /\\{\\$([^}]+)}/g;\n","/**\n * @license\n * Copyright 2019 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport {\n  InstantiationMode,\n  InstanceFactory,\n  ComponentType,\n  Dictionary,\n  Name,\n  onInstanceCreatedCallback\n} from './types';\n\n/**\n * Component for service name T, e.g. `auth`, `auth-internal`\n */\nexport class Component<T extends Name = Name> {\n  multipleInstances = false;\n  /**\n   * Properties to be added to the service namespace\n   */\n  serviceProps: Dictionary = {};\n\n  instantiationMode = InstantiationMode.LAZY;\n\n  onInstanceCreated: onInstanceCreatedCallback<T> | null = null;\n\n  /**\n   *\n   * @param name The public service name, e.g. app, auth, firestore, database\n   * @param instanceFactory Service factory responsible for creating the public interface\n   * @param type whether the service provided by the component is public or private\n   */\n  constructor(\n    readonly name: T,\n    readonly instanceFactory: InstanceFactory<T>,\n    readonly type: ComponentType\n  ) {}\n\n  setInstantiationMode(mode: InstantiationMode): this {\n    this.instantiationMode = mode;\n    return this;\n  }\n\n  setMultipleInstances(multipleInstances: boolean): this {\n    this.multipleInstances = multipleInstances;\n    return this;\n  }\n\n  setServiceProps(props: Dictionary): this {\n    this.serviceProps = props;\n    return this;\n  }\n\n  setInstanceCreatedCallback(callback: onInstanceCreatedCallback<T>): this {\n    this.onInstanceCreated = callback;\n    return this;\n  }\n}\n","/**\n * @license\n * Copyright 2017 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport type LogLevelString =\n  | 'debug'\n  | 'verbose'\n  | 'info'\n  | 'warn'\n  | 'error'\n  | 'silent';\n\nexport interface LogOptions {\n  level: LogLevelString;\n}\n\nexport type LogCallback = (callbackParams: LogCallbackParams) => void;\n\nexport interface LogCallbackParams {\n  level: LogLevelString;\n  message: string;\n  args: unknown[];\n  type: string;\n}\n\n/**\n * A container for all of the Logger instances\n */\nexport const instances: Logger[] = [];\n\n/**\n * The JS SDK supports 5 log levels and also allows a user the ability to\n * silence the logs altogether.\n *\n * The order is a follows:\n * DEBUG < VERBOSE < INFO < WARN < ERROR\n *\n * All of the log types above the current log level will be captured (i.e. if\n * you set the log level to `INFO`, errors will still be logged, but `DEBUG` and\n * `VERBOSE` logs will not)\n */\nexport enum LogLevel {\n  DEBUG,\n  VERBOSE,\n  INFO,\n  WARN,\n  ERROR,\n  SILENT\n}\n\nconst levelStringToEnum: { [key in LogLevelString]: LogLevel } = {\n  'debug': LogLevel.DEBUG,\n  'verbose': LogLevel.VERBOSE,\n  'info': LogLevel.INFO,\n  'warn': LogLevel.WARN,\n  'error': LogLevel.ERROR,\n  'silent': LogLevel.SILENT\n};\n\n/**\n * The default log level\n */\nconst defaultLogLevel: LogLevel = LogLevel.INFO;\n\n/**\n * We allow users the ability to pass their own log handler. We will pass the\n * type of log, the current log level, and any other arguments passed (i.e. the\n * messages that the user wants to log) to this function.\n */\nexport type LogHandler = (\n  loggerInstance: Logger,\n  logType: LogLevel,\n  ...args: unknown[]\n) => void;\n\n/**\n * By default, `console.debug` is not displayed in the developer console (in\n * chrome). To avoid forcing users to have to opt-in to these logs twice\n * (i.e. once for firebase, and once in the console), we are sending `DEBUG`\n * logs to the `console.log` function.\n */\nconst ConsoleMethod = {\n  [LogLevel.DEBUG]: 'log',\n  [LogLevel.VERBOSE]: 'log',\n  [LogLevel.INFO]: 'info',\n  [LogLevel.WARN]: 'warn',\n  [LogLevel.ERROR]: 'error'\n};\n\n/**\n * The default log handler will forward DEBUG, VERBOSE, INFO, WARN, and ERROR\n * messages on to their corresponding console counterparts (if the log method\n * is supported by the current log level)\n */\nconst defaultLogHandler: LogHandler = (instance, logType, ...args): void => {\n  if (logType < instance.logLevel) {\n    return;\n  }\n  const now = new Date().toISOString();\n  const method = ConsoleMethod[logType as keyof typeof ConsoleMethod];\n  if (method) {\n    console[method as 'log' | 'info' | 'warn' | 'error'](\n      `[${now}]  ${instance.name}:`,\n      ...args\n    );\n  } else {\n    throw new Error(\n      `Attempted to log a message with an invalid logType (value: ${logType})`\n    );\n  }\n};\n\nexport class Logger {\n  /**\n   * Gives you an instance of a Logger to capture messages according to\n   * Firebase's logging scheme.\n   *\n   * @param name The name that the logs will be associated with\n   */\n  constructor(public name: string) {\n    /**\n     * Capture the current instance for later use\n     */\n    instances.push(this);\n  }\n\n  /**\n   * The log level of the given Logger instance.\n   */\n  private _logLevel = defaultLogLevel;\n\n  get logLevel(): LogLevel {\n    return this._logLevel;\n  }\n\n  set logLevel(val: LogLevel) {\n    if (!(val in LogLevel)) {\n      throw new TypeError(`Invalid value \"${val}\" assigned to \\`logLevel\\``);\n    }\n    this._logLevel = val;\n  }\n\n  // Workaround for setter/getter having to be the same type.\n  setLogLevel(val: LogLevel | LogLevelString): void {\n    this._logLevel = typeof val === 'string' ? levelStringToEnum[val] : val;\n  }\n\n  /**\n   * The main (internal) log handler for the Logger instance.\n   * Can be set to a new function in internal package code but not by user.\n   */\n  private _logHandler: LogHandler = defaultLogHandler;\n  get logHandler(): LogHandler {\n    return this._logHandler;\n  }\n  set logHandler(val: LogHandler) {\n    if (typeof val !== 'function') {\n      throw new TypeError('Value assigned to `logHandler` must be a function');\n    }\n    this._logHandler = val;\n  }\n\n  /**\n   * The optional, additional, user-defined log handler for the Logger instance.\n   */\n  private _userLogHandler: LogHandler | null = null;\n  get userLogHandler(): LogHandler | null {\n    return this._userLogHandler;\n  }\n  set userLogHandler(val: LogHandler | null) {\n    this._userLogHandler = val;\n  }\n\n  /**\n   * The functions below are all based on the `console` interface\n   */\n\n  debug(...args: unknown[]): void {\n    this._userLogHandler && this._userLogHandler(this, LogLevel.DEBUG, ...args);\n    this._logHandler(this, LogLevel.DEBUG, ...args);\n  }\n  log(...args: unknown[]): void {\n    this._userLogHandler &&\n      this._userLogHandler(this, LogLevel.VERBOSE, ...args);\n    this._logHandler(this, LogLevel.VERBOSE, ...args);\n  }\n  info(...args: unknown[]): void {\n    this._userLogHandler && this._userLogHandler(this, LogLevel.INFO, ...args);\n    this._logHandler(this, LogLevel.INFO, ...args);\n  }\n  warn(...args: unknown[]): void {\n    this._userLogHandler && this._userLogHandler(this, LogLevel.WARN, ...args);\n    this._logHandler(this, LogLevel.WARN, ...args);\n  }\n  error(...args: unknown[]): void {\n    this._userLogHandler && this._userLogHandler(this, LogLevel.ERROR, ...args);\n    this._logHandler(this, LogLevel.ERROR, ...args);\n  }\n}\n\nexport function setLogLevel(level: LogLevelString | LogLevel): void {\n  instances.forEach(inst => {\n    inst.setLogLevel(level);\n  });\n}\n\nexport function setUserLogHandler(\n  logCallback: LogCallback | null,\n  options?: LogOptions\n): void {\n  for (const instance of instances) {\n    let customLogLevel: LogLevel | null = null;\n    if (options && options.level) {\n      customLogLevel = levelStringToEnum[options.level];\n    }\n    if (logCallback === null) {\n      instance.userLogHandler = null;\n    } else {\n      instance.userLogHandler = (\n        instance: Logger,\n        level: LogLevel,\n        ...args: unknown[]\n      ) => {\n        const message = args\n          .map(arg => {\n            if (arg == null) {\n              return null;\n            } else if (typeof arg === 'string') {\n              return arg;\n            } else if (typeof arg === 'number' || typeof arg === 'boolean') {\n              return arg.toString();\n            } else if (arg instanceof Error) {\n              return arg.message;\n            } else {\n              try {\n                return JSON.stringify(arg);\n              } catch (ignored) {\n                return null;\n              }\n            }\n          })\n          .filter(arg => arg)\n          .join(' ');\n        if (level >= (customLogLevel ?? instance.logLevel)) {\n          logCallback({\n            level: LogLevel[level].toLowerCase() as LogLevelString,\n            message,\n            args,\n            type: instance.name\n          });\n        }\n      };\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/** The semver (www.semver.org) version of the SDK. */\nexport let SDK_VERSION = '';\n\n/**\n * SDK_VERSION should be set before any database instance is created\n * @internal\n */\nexport function setSDKVersion(version: string): void {\n  SDK_VERSION = version;\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseError } from '@firebase/util';\n\nexport type DataConnectErrorCode =\n  | 'other'\n  | 'already-initialized'\n  | 'not-initialized'\n  | 'not-supported'\n  | 'invalid-argument'\n  | 'partial-error'\n  | 'unauthorized';\n\nexport type Code = DataConnectErrorCode;\n\nexport const Code = {\n  OTHER: 'other' as DataConnectErrorCode,\n  ALREADY_INITIALIZED: 'already-initialized' as DataConnectErrorCode,\n  NOT_INITIALIZED: 'not-initialized' as DataConnectErrorCode,\n  NOT_SUPPORTED: 'not-supported' as DataConnectErrorCode,\n  INVALID_ARGUMENT: 'invalid-argument' as DataConnectErrorCode,\n  PARTIAL_ERROR: 'partial-error' as DataConnectErrorCode,\n  UNAUTHORIZED: 'unauthorized' as DataConnectErrorCode\n};\n\n/** An error returned by a DataConnect operation. */\nexport class DataConnectError extends FirebaseError {\n  /** @internal */\n  readonly name: string = 'DataConnectError';\n\n  constructor(code: Code, message: string) {\n    super(code, message);\n\n    // Ensure the instanceof operator works as expected on subclasses of Error.\n    // See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error#custom_error_types\n    // and https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-2.html#support-for-newtarget\n    Object.setPrototypeOf(this, DataConnectError.prototype);\n  }\n\n  /** @internal */\n  toString(): string {\n    return `${this.name}[code=${this.code}]: ${this.message}`;\n  }\n}\n\n/** An error returned by a DataConnect operation. */\nexport class DataConnectOperationError extends DataConnectError {\n  /** @internal */\n  readonly name: string = 'DataConnectOperationError';\n\n  /** The response received from the backend. */\n  readonly response: DataConnectOperationFailureResponse;\n\n  /** @hideconstructor */\n  constructor(message: string, response: DataConnectOperationFailureResponse) {\n    super(Code.PARTIAL_ERROR, message);\n    this.response = response;\n  }\n}\n\nexport interface DataConnectOperationFailureResponse {\n  // The \"data\" provided by the backend in the response message.\n  //\n  // Will be `undefined` if no \"data\" was provided in the response message.\n  // Otherwise, will be `null` if `null` was explicitly specified as the \"data\"\n  // in the response message. Otherwise, will be the value of the \"data\"\n  // specified as the \"data\" in the response message\n  readonly data?: Record<string, unknown> | null;\n\n  // The list of errors provided by the backend in the response message.\n  readonly errors: DataConnectOperationFailureResponseErrorInfo[];\n}\n\n// Information about the error, as provided in the response from the backend.\n// See https://spec.graphql.org/draft/#sec-Errors\nexport interface DataConnectOperationFailureResponseErrorInfo {\n  // The error message.\n  readonly message: string;\n\n  // The path of the field in the response data to which this error relates.\n  // String values in this array refer to field names. Numeric values in this\n  // array always satisfy `Number.isInteger()` and refer to the index in an\n  // array.\n  readonly path: Array<string | number>;\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport type FDCScalarValue =\n  | string\n  | number\n  | boolean\n  | undefined\n  | null\n  | Record<string, unknown>\n  | FDCScalarValue[];\n\nexport interface EntityDataObjectJson {\n  map: {\n    [key: string]: FDCScalarValue;\n  };\n  referencedFrom: string[];\n  globalID: string;\n}\n\nexport class EntityDataObject {\n  getServerValue(key: string): unknown {\n    return this.serverValues[key];\n  }\n  private serverValues: { [key: string]: FDCScalarValue } = {};\n  private referencedFrom = new Set<string>();\n  constructor(public readonly globalID: string) {}\n  getServerValues(): { [key: string]: FDCScalarValue } {\n    return this.serverValues;\n  }\n  toJSON(): EntityDataObjectJson {\n    return {\n      globalID: this.globalID,\n      map: this.serverValues,\n      referencedFrom: Array.from(this.referencedFrom)\n    };\n  }\n  static fromJSON(json: EntityDataObjectJson): EntityDataObject {\n    const edo = new EntityDataObject(json.globalID);\n    edo.serverValues = json.map;\n    edo.referencedFrom = new Set(json.referencedFrom);\n    return edo;\n  }\n\n  updateServerValue(\n    key: string,\n    value: FDCScalarValue,\n    requestedFrom: string\n  ): string[] {\n    this.serverValues[key] = value;\n    this.referencedFrom.add(requestedFrom);\n    return Array.from(this.referencedFrom);\n  }\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InternalCacheProvider } from './CacheProvider';\nimport { EntityDataObject } from './EntityDataObject';\nimport { ResultTree } from './ResultTree';\n\nexport class InMemoryCacheProvider implements InternalCacheProvider {\n  private edos = new Map<string, EntityDataObject>();\n  private resultTrees = new Map<string, ResultTree>();\n  constructor(private _keyId: string) {}\n\n  async setResultTree(queryId: string, rt: ResultTree): Promise<void> {\n    this.resultTrees.set(queryId, rt);\n  }\n  async getResultTree(queryId: string): Promise<ResultTree | undefined> {\n    return this.resultTrees.get(queryId);\n  }\n  async updateEntityData(entityData: EntityDataObject): Promise<void> {\n    this.edos.set(entityData.globalID, entityData);\n  }\n  async getEntityData(globalId: string): Promise<EntityDataObject> {\n    if (!this.edos.has(globalId)) {\n      this.edos.set(globalId, new EntityDataObject(globalId));\n    }\n    // Because of the above, we can guarantee that there will be an EDO at the globalId.\n    return this.edos.get(globalId)!;\n  }\n  close(): Promise<void> {\n    // No-op\n    return Promise.resolve();\n  }\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Code, DataConnectError } from '../core/error';\n\nimport { InternalCacheProvider } from './CacheProvider';\nimport {\n  EntityDataObject,\n  EntityDataObjectJson,\n  FDCScalarValue\n} from './EntityDataObject';\nimport { ImpactedQueryRefsAccumulator } from './ImpactedQueryRefsAccumulator';\n\nexport const GLOBAL_ID_KEY = '_id';\nexport const OBJECT_LISTS_KEY = '_objectLists';\nexport const REFERENCES_KEY = '_references';\nexport const SCALARS_KEY = '_scalars';\nexport const ENTITY_DATA_KEYS_KEY = '_entity_data_keys';\nexport class EntityNode {\n  entityData?: EntityDataObject;\n  scalars: Record<string, FDCScalarValue> = {};\n  references: { [key: string]: EntityNode } = {};\n  objectLists: {\n    [key: string]: EntityNode[];\n  } = {};\n  globalId?: string;\n  entityDataKeys: Set<string> = new Set();\n\n  async loadData(\n    queryId: string,\n    values: FDCScalarValue,\n    entityIds: Record<string, unknown> | undefined,\n    acc: ImpactedQueryRefsAccumulator,\n    cacheProvider: InternalCacheProvider\n  ): Promise<void> {\n    if (values === undefined) {\n      return;\n    }\n    if (typeof values !== 'object' || Array.isArray(values)) {\n      throw new DataConnectError(\n        Code.INVALID_ARGUMENT,\n        'EntityNode initialized with non-object value'\n      );\n    }\n    if (values === null) {\n      return;\n    }\n\n    if (\n      typeof values === 'object' &&\n      entityIds &&\n      entityIds[GLOBAL_ID_KEY] &&\n      typeof entityIds[GLOBAL_ID_KEY] === 'string'\n    ) {\n      this.globalId = entityIds[GLOBAL_ID_KEY];\n      this.entityData = await cacheProvider.getEntityData(this.globalId);\n    }\n    for (const key in values) {\n      if (values.hasOwnProperty(key)) {\n        if (typeof values[key] === 'object') {\n          if (Array.isArray(values[key])) {\n            const ids: Record<string, unknown> | undefined =\n              entityIds && (entityIds[key] as Record<string, unknown>);\n            const objArray: EntityNode[] = [];\n            const scalarArray: Array<NonNullable<FDCScalarValue>> = [];\n            for (const [index, value] of values[key].entries()) {\n              if (typeof value === 'object') {\n                if (Array.isArray(value)) {\n                  // Note: we don't support sparse arrays.\n                } else {\n                  const entityNode = new EntityNode();\n                  await entityNode.loadData(\n                    queryId,\n                    value,\n                    ids && (ids[index] as Record<string, unknown>),\n                    acc,\n                    cacheProvider\n                  );\n                  objArray.push(entityNode);\n                }\n              } else {\n                scalarArray.push(value);\n              }\n            }\n            if (scalarArray.length > 0 && objArray.length > 0) {\n              this.scalars[key] = values[key];\n            } else if (scalarArray.length > 0) {\n              if (this.entityData) {\n                const impactedRefs = this.entityData.updateServerValue(\n                  key,\n                  scalarArray,\n                  queryId\n                );\n                this.entityDataKeys.add(key);\n                acc.add(impactedRefs);\n              } else {\n                this.scalars[key] = scalarArray;\n              }\n            } else if (objArray.length > 0) {\n              this.objectLists[key] = objArray;\n            } else {\n              this.scalars[key] = [];\n            }\n          } else {\n            if (values[key] === null) {\n              this.scalars[key] = null;\n              continue;\n            }\n            const entityNode = new EntityNode();\n            // TODO: Load Data might need to be pushed into ResultTreeProcessor instead.\n            await entityNode.loadData(\n              queryId,\n              (values as Record<string, FDCScalarValue>)[key],\n              entityIds && (entityIds[key] as Record<string, unknown>),\n              acc,\n              cacheProvider\n            );\n            this.references[key] = entityNode;\n          }\n        } else {\n          if (this.entityData) {\n            const impactedRefs = this.entityData.updateServerValue(\n              key,\n              values[key] as FDCScalarValue,\n              queryId\n            );\n            this.entityDataKeys.add(key);\n            acc.add(impactedRefs);\n          } else {\n            this.scalars[key] = values[key] as FDCScalarValue;\n          }\n        }\n      }\n    }\n    if (this.entityData) {\n      await cacheProvider.updateEntityData(this.entityData);\n    }\n  }\n\n  toJSON(mode: EncodingMode): Record<string, unknown> {\n    const resultObject: Record<string, unknown> = {};\n    if (mode === EncodingMode.hydrated) {\n      if (this.entityData) {\n        for (const key of this.entityDataKeys) {\n          resultObject[key] = this.entityData.getServerValue(key);\n        }\n      }\n\n      if (this.scalars) {\n        Object.assign(resultObject, this.scalars);\n      }\n      if (this.references) {\n        for (const key in this.references) {\n          if (this.references.hasOwnProperty(key)) {\n            resultObject[key] = this.references[key].toJSON(mode);\n          }\n        }\n      }\n      if (this.objectLists) {\n        for (const key in this.objectLists) {\n          if (this.objectLists.hasOwnProperty(key)) {\n            resultObject[key] = this.objectLists[key].map(obj =>\n              obj.toJSON(mode)\n            );\n          }\n        }\n      }\n      return resultObject;\n    } else {\n      // Get JSON representation of dehydrated list\n      if (this.entityData) {\n        resultObject[GLOBAL_ID_KEY] = this.entityData.globalID;\n      }\n\n      resultObject[ENTITY_DATA_KEYS_KEY] = Array.from(this.entityDataKeys);\n\n      if (this.scalars) {\n        resultObject[SCALARS_KEY] = this.scalars;\n      }\n\n      if (this.references) {\n        const references = {} as Record<string, unknown>;\n        for (const key in this.references) {\n          if (this.references.hasOwnProperty(key)) {\n            references[key] = this.references[key].toJSON(mode);\n          }\n        }\n        resultObject[REFERENCES_KEY] = references;\n      }\n      if (this.objectLists) {\n        const objectLists = {} as Record<string, unknown>;\n        for (const key in this.objectLists) {\n          if (this.objectLists.hasOwnProperty(key)) {\n            objectLists[key] = this.objectLists[key].map(obj =>\n              obj.toJSON(mode)\n            );\n          }\n        }\n        resultObject[OBJECT_LISTS_KEY] = objectLists;\n      }\n    }\n\n    return resultObject;\n  }\n\n  static fromJson(obj: DehydratedStubDataObject): EntityNode {\n    const sdo = new EntityNode();\n    if (obj.backingData) {\n      sdo.entityData = EntityDataObject.fromJSON(obj.backingData);\n    }\n    sdo.globalId = obj.globalID;\n    sdo.scalars = obj.scalars;\n    if (obj.references) {\n      const references: Record<string, unknown> = {};\n      for (const key in obj.references) {\n        if (obj.references.hasOwnProperty(key)) {\n          references[key] = EntityNode.fromJson(obj.references[key]);\n        }\n      }\n      sdo.references = references as typeof sdo.references;\n    }\n    if (obj.objectLists) {\n      const objectLists: Record<string, unknown> = {};\n      for (const key in obj.objectLists) {\n        if (obj.objectLists.hasOwnProperty(key)) {\n          objectLists[key] = obj.objectLists[key].map(obj =>\n            EntityNode.fromJson(obj)\n          );\n        }\n      }\n      sdo.objectLists = objectLists as typeof sdo.objectLists;\n    }\n    return sdo;\n  }\n}\n\nexport interface DehydratedStubDataObject {\n  backingData?: EntityDataObjectJson;\n  globalID?: string;\n  scalars: { [key: string]: FDCScalarValue };\n  references: { [key: string]: DehydratedStubDataObject };\n  objectLists: {\n    [key: string]: DehydratedStubDataObject[];\n  };\n}\n\n// Helpful for storing in persistent cache, which is not available yet.\nexport enum EncodingMode {\n  hydrated,\n  dehydrated\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EntityNode, DehydratedStubDataObject } from './EntityNode';\n\nexport class ResultTree {\n  /**\n   * Create a {@link ResultTree} from a dehydrated JSON object.\n   * @param value The dehydrated JSON object.\n   * @returns The {@link ResultTree}.\n   */\n  static fromJson(value: DehydratedResultTreeJson): ResultTree {\n    return new ResultTree(\n      EntityNode.fromJson(value.rootStub),\n      value.maxAge,\n      value.cachedAt,\n      value.lastAccessed\n    );\n  }\n  constructor(\n    private rootStub: EntityNode,\n    private maxAge: number = 0,\n    public readonly cachedAt: Date,\n    private _lastAccessed: Date\n  ) {}\n  isStale(): boolean {\n    return (\n      Date.now() - new Date(this.cachedAt.getTime()).getTime() >\n      this.maxAge * 1000\n    );\n  }\n  updateMaxAge(maxAgeInSeconds: number): void {\n    this.maxAge = maxAgeInSeconds;\n  }\n  updateAccessed(): void {\n    this._lastAccessed = new Date();\n  }\n  get lastAccessed(): Date {\n    return this._lastAccessed;\n  }\n  getRootStub(): EntityNode {\n    return this.rootStub;\n  }\n}\n\ninterface DehydratedResultTreeJson {\n  rootStub: DehydratedStubDataObject;\n  maxAge: number;\n  cachedAt: Date;\n  lastAccessed: Date;\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport class ImpactedQueryRefsAccumulator {\n  impacted = new Set<string>();\n  constructor(private queryId: string) {}\n  add(impacted: string[]): void {\n    impacted\n      .filter(ref => ref !== this.queryId)\n      .forEach(ref => this.impacted.add(ref));\n  }\n  consumeEvents(): string[] {\n    const events = Array.from(this.impacted);\n    this.impacted.clear();\n    return events;\n  }\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { InternalCacheProvider } from './CacheProvider';\nimport { EncodingMode, EntityNode } from './EntityNode';\nimport { ImpactedQueryRefsAccumulator } from './ImpactedQueryRefsAccumulator';\n\ninterface DehydratedResults {\n  entityNode: EntityNode;\n  impacted: string[];\n}\n\nexport class ResultTreeProcessor {\n  /**\n   * Hydrate the EntityNode into a JSON object so that it can be returned to the user.\n   * @param rootStubObject\n   * @returns {string}\n   */\n  hydrateResults(rootStubObject: EntityNode): Record<string, unknown> {\n    return rootStubObject.toJSON(EncodingMode.hydrated);\n  }\n  /**\n   * Dehydrate results so that they can be stored in the cache.\n   * @param json\n   * @param entityIds\n   * @param cacheProvider\n   * @param queryId\n   * @returns {Promise<DehydratedResults>}\n   */\n  async dehydrateResults(\n    json: Record<string, unknown>,\n    entityIds: Record<string, unknown>,\n    cacheProvider: InternalCacheProvider,\n    queryId: string\n  ): Promise<DehydratedResults> {\n    const acc = new ImpactedQueryRefsAccumulator(queryId);\n    const entityNode = new EntityNode();\n    await entityNode.loadData(queryId, json, entityIds, acc, cacheProvider);\n    return {\n      entityNode,\n      impacted: acc.consumeEvents()\n    };\n  }\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { generateSHA256Hash } from '@firebase/util';\n\nimport {\n  CacheProvider,\n  CacheSettings,\n  type ConnectorConfig\n} from '../api/DataConnect';\nimport { Code, DataConnectError } from '../core/error';\nimport { type AuthTokenProvider } from '../core/FirebaseAuthProvider';\n\nimport { InternalCacheProvider } from './CacheProvider';\nimport { InMemoryCacheProvider } from './InMemoryCacheProvider';\nimport { ResultTree } from './ResultTree';\nimport { ResultTreeProcessor } from './ResultTreeProcessor';\n\nexport const Memory = 'memory';\n\nexport type DataConnectStorage = typeof Memory;\n\n/**\n * ServerValues\n */\nexport interface ServerValues extends Record<string, unknown> {\n  maxAge?: number;\n}\n\nexport class DataConnectCache {\n  private cacheProvider: InternalCacheProvider | null = null;\n  private uid: string | null = null;\n  constructor(\n    private authProvider: AuthTokenProvider,\n    private projectId: string,\n    private connectorConfig: ConnectorConfig,\n    private host: string,\n    public cacheSettings: CacheSettings\n  ) {\n    this.authProvider.addTokenChangeListener(async _ => {\n      const newUid = this.authProvider.getAuth().getUid();\n      // We should only close if the token changes and so does the new UID\n      if (this.uid !== newUid) {\n        this.cacheProvider?.close();\n        this.uid = newUid;\n        const identifier = await this.getIdentifier(this.uid);\n        this.cacheProvider = this.initializeNewProviders(identifier);\n      }\n    });\n  }\n\n  async initialize(): Promise<void> {\n    if (!this.cacheProvider) {\n      const identifier = await this.getIdentifier(this.uid);\n      this.cacheProvider = this.initializeNewProviders(identifier);\n    }\n  }\n\n  async getIdentifier(uid: string | null): Promise<string> {\n    const identifier = `${\n      'memory' // TODO: replace this with indexeddb when persistence is available.\n    }-${this.projectId}-${this.connectorConfig.service}-${\n      this.connectorConfig.connector\n    }-${this.connectorConfig.location}-${uid}-${this.host}`;\n    const sha256 = await generateSHA256Hash(identifier);\n    return sha256;\n  }\n\n  initializeNewProviders(identifier: string): InternalCacheProvider {\n    return this.cacheSettings.cacheProvider.initialize(identifier);\n  }\n\n  async containsResultTree(queryId: string): Promise<boolean> {\n    await this.initialize();\n    const resultTree = await this.cacheProvider!.getResultTree(queryId);\n    return resultTree !== undefined;\n  }\n  async getResultTree(queryId: string): Promise<ResultTree | undefined> {\n    await this.initialize();\n    return this.cacheProvider!.getResultTree(queryId);\n  }\n  async getResultJSON(queryId: string): Promise<Record<string, unknown>> {\n    await this.initialize();\n    const processor = new ResultTreeProcessor();\n    const cacheProvider = this.cacheProvider;\n    const resultTree = await cacheProvider!.getResultTree(queryId);\n    if (!resultTree) {\n      throw new DataConnectError(\n        Code.INVALID_ARGUMENT,\n        `${queryId} not found in cache. Call \"update()\" first.`\n      );\n    }\n    return processor.hydrateResults(resultTree.getRootStub());\n  }\n  async update(\n    queryId: string,\n    serverValues: ServerValues,\n    entityIds: Record<string, unknown>\n  ): Promise<string[]> {\n    await this.initialize();\n    const processor = new ResultTreeProcessor();\n    const cacheProvider = this.cacheProvider;\n    const { entityNode: stubDataObject, impacted } =\n      await processor.dehydrateResults(\n        serverValues,\n        entityIds,\n        cacheProvider!,\n        queryId\n      );\n    const now = new Date();\n    await cacheProvider!.setResultTree(\n      queryId,\n      new ResultTree(\n        stubDataObject,\n        serverValues.maxAge || this.cacheSettings.maxAgeSeconds,\n        now,\n        now\n      )\n    );\n    return impacted;\n  }\n}\n\nexport class MemoryStub implements CacheProvider<'MEMORY'> {\n  type: 'MEMORY' = 'MEMORY';\n  /**\n   * @internal\n   */\n  initialize(cacheId: string): InMemoryCacheProvider {\n    return new InMemoryCacheProvider(cacheId);\n  }\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * @public\n * Generates a SHA-256 hash for the given input string.\n *\n * @param input The string to hash.\n * @returns A promise that resolves to the SHA-256 hash as a hex string.\n */\nexport async function generateSHA256Hash(input: string): Promise<string> {\n  const textEncoder = new TextEncoder();\n  const data = textEncoder.encode(input);\n  const hashBuffer = await crypto.subtle.digest('SHA-256', data);\n\n  // Convert ArrayBuffer to hex string\n  const hashArray = Array.from(new Uint8Array(hashBuffer));\n  const hexHash = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');\n  return hexHash;\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseApp, _isFirebaseServerApp } from '@firebase/app';\nimport {\n  AppCheckInternalComponentName,\n  AppCheckTokenListener,\n  AppCheckTokenResult,\n  FirebaseAppCheckInternal\n} from '@firebase/app-check-interop-types';\nimport { Provider } from '@firebase/component';\n\n/**\n * @internal\n * Abstraction around AppCheck's token fetching capabilities.\n */\nexport class AppCheckTokenProvider {\n  private appCheck?: FirebaseAppCheckInternal | null;\n  private serverAppAppCheckToken?: string;\n  constructor(\n    app: FirebaseApp,\n    private appCheckProvider?: Provider<AppCheckInternalComponentName>\n  ) {\n    if (_isFirebaseServerApp(app) && app.settings.appCheckToken) {\n      this.serverAppAppCheckToken = app.settings.appCheckToken;\n    }\n    this.appCheck = appCheckProvider?.getImmediate({ optional: true });\n    if (!this.appCheck) {\n      void appCheckProvider\n        ?.get()\n        .then(appCheck => (this.appCheck = appCheck))\n        .catch();\n    }\n  }\n\n  getToken(): Promise<AppCheckTokenResult | null> {\n    if (this.serverAppAppCheckToken) {\n      return Promise.resolve({ token: this.serverAppAppCheckToken });\n    }\n\n    if (!this.appCheck) {\n      return new Promise<AppCheckTokenResult | null>((resolve, reject) => {\n        // Support delayed initialization of FirebaseAppCheck. This allows our\n        // customers to initialize the RTDB SDK before initializing Firebase\n        // AppCheck and ensures that all requests are authenticated if a token\n        // becomes available before the timoeout below expires.\n        setTimeout(() => {\n          if (this.appCheck) {\n            this.getToken().then(resolve, reject);\n          } else {\n            resolve(null);\n          }\n        }, 0);\n      });\n    }\n    return this.appCheck.getToken();\n  }\n\n  addTokenChangeListener(listener: AppCheckTokenListener): void {\n    void this.appCheckProvider\n      ?.get()\n      .then(appCheck => appCheck.addTokenListener(listener));\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Logger, LogLevelString } from '@firebase/logger';\n\nimport { SDK_VERSION } from './core/version';\n\nconst logger = new Logger('@firebase/data-connect');\nexport function setLogLevel(logLevel: LogLevelString): void {\n  logger.setLogLevel(logLevel);\n}\nexport function logDebug(msg: string): void {\n  logger.debug(`DataConnect (${SDK_VERSION}): ${msg}`);\n}\n\nexport function logError(msg: string): void {\n  logger.error(`DataConnect (${SDK_VERSION}): ${msg}`);\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FirebaseOptions } from '@firebase/app-types';\nimport {\n  FirebaseAuthInternal,\n  FirebaseAuthInternalName,\n  FirebaseAuthTokenData\n} from '@firebase/auth-interop-types';\nimport { Provider } from '@firebase/component';\n\nimport { logDebug, logError } from '../logger';\n\n// @internal\nexport interface AuthTokenProvider {\n  getToken(forceRefresh: boolean): Promise<FirebaseAuthTokenData | null>;\n  addTokenChangeListener(listener: AuthTokenListener): void;\n  getAuth(): FirebaseAuthInternal;\n}\nexport type AuthTokenListener = (token: string | null) => void;\n\n// @internal\nexport class FirebaseAuthProvider implements AuthTokenProvider {\n  private _auth: FirebaseAuthInternal;\n  constructor(\n    private _appName: string,\n    private _options: FirebaseOptions,\n    private _authProvider: Provider<FirebaseAuthInternalName>\n  ) {\n    this._auth = _authProvider.getImmediate({ optional: true })!;\n    if (!this._auth) {\n      _authProvider.onInit(auth => (this._auth = auth));\n    }\n  }\n  getAuth(): FirebaseAuthInternal {\n    return this._auth;\n  }\n  getToken(forceRefresh: boolean): Promise<FirebaseAuthTokenData | null> {\n    if (!this._auth) {\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          if (this._auth) {\n            this.getToken(forceRefresh).then(resolve, reject);\n          } else {\n            resolve(null);\n          }\n        }, 0);\n      });\n    }\n    return this._auth.getToken(forceRefresh).catch(error => {\n      if (error && error.code === 'auth/token-not-initialized') {\n        logDebug(\n          'Got auth/token-not-initialized error.  Treating as null token.'\n        );\n        return null;\n      } else {\n        logError(\n          'Error received when attempting to retrieve token: ' +\n            JSON.stringify(error)\n        );\n        return Promise.reject(error);\n      }\n    });\n  }\n  addTokenChangeListener(listener: AuthTokenListener): void {\n    this._auth?.addAuthTokenListener(listener);\n  }\n  removeTokenChangeListener(listener: (token: string | null) => void): void {\n    this._authProvider\n      .get()\n      .then(auth => auth.removeAuthTokenListener(listener))\n      .catch(err => logError(err));\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Extensions } from '../network';\n\nimport { DataConnect, DataConnectOptions } from './DataConnect';\nexport const QUERY_STR = 'query';\nexport const MUTATION_STR = 'mutation';\nexport type ReferenceType = typeof QUERY_STR | typeof MUTATION_STR;\n\nexport const SOURCE_SERVER = 'SERVER';\nexport const SOURCE_CACHE = 'CACHE';\nexport type DataSource = typeof SOURCE_CACHE | typeof SOURCE_SERVER;\n\nexport interface OpResult<Data> {\n  data: Data;\n  source: DataSource;\n  fetchTime: string;\n  extensions?: Extensions;\n}\n\nexport interface OperationRef<_Data, Variables> {\n  name: string;\n  variables: Variables;\n  refType: ReferenceType;\n  dataConnect: DataConnect;\n}\n\nexport interface DataConnectResult<Data, Variables> extends OpResult<Data> {\n  ref: OperationRef<Data, Variables>;\n  // future metadata\n}\n\n/**\n * Serialized RefInfo as a result of `QueryResult.toJSON().refInfo`\n */\nexport interface RefInfo<Variables> {\n  name: string;\n  variables: Variables;\n  connectorConfig: DataConnectOptions;\n}\n/**\n * Serialized Ref as a result of `QueryResult.toJSON()`\n */\nexport interface SerializedRef<Data, Variables> extends OpResult<Data> {\n  refInfo: RefInfo<Variables>;\n}\n","/**\n * @license\n * Copyright 2026 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { OpResult } from '../api/Reference';\nimport { DataConnectExtension } from '../network';\nexport function parseEntityIds<T>(\n  result: OpResult<T>\n): Record<string, unknown> {\n  // Iterate through extensions.dataConnect\n  const dataConnectExtensions = result.extensions?.dataConnect;\n  const dataCopy = Object.assign(result);\n  if (!dataConnectExtensions) {\n    return dataCopy;\n  }\n  const ret: Record<string, unknown> = {};\n  for (const extension of dataConnectExtensions) {\n    const { path } = extension;\n    populatePath(path, ret, extension);\n  }\n  return ret;\n}\n\n// mutates the object to update the path\nexport function populatePath(\n  path: Array<string | number>,\n  toUpdate: Record<string | number, unknown>,\n  extension: DataConnectExtension\n): void {\n  let curObj: Record<string | number, unknown> = toUpdate;\n  for (const slice of path) {\n    if (typeof curObj[slice] !== 'object') {\n      curObj[slice] = {};\n    }\n    curObj = curObj[slice] as Record<string, unknown>;\n  }\n\n  if ('entityId' in extension && extension.entityId) {\n    curObj['_id'] = extension.entityId;\n  } else if ('entityIds' in extension) {\n    const entityArr = extension.entityIds;\n    for (let i = 0; i < entityArr.length; i++) {\n      const entityId = entityArr[i];\n      if (typeof curObj[i] === 'undefined') {\n        curObj[i] = {};\n      }\n      (curObj[i] as Record<string, unknown>)._id = entityId;\n    }\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport type HmacImpl = (obj: Record<string, unknown>) => string;\nexport let encoderImpl: HmacImpl;\nexport type DecodeHmacImpl = (s: string) => Record<string, unknown>;\nexport let decoderImpl: DecodeHmacImpl;\nexport function setEncoder(encoder: HmacImpl): void {\n  encoderImpl = encoder;\n}\nexport function setDecoder(decoder: DecodeHmacImpl): void {\n  decoderImpl = decoder;\n}\nfunction sortKeysForObj(o: Record<string, unknown>): Record<string, unknown> {\n  return Object.keys(o)\n    .sort()\n    .reduce((accumulator, currentKey) => {\n      accumulator[currentKey] = o[currentKey];\n      return accumulator;\n    }, {} as Record<string, unknown>);\n}\nsetEncoder((o: Record<string, unknown>) => JSON.stringify(sortKeysForObj(o)));\nsetDecoder(s => sortKeysForObj(JSON.parse(s)));\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { type DataConnect } from '../../api/DataConnect';\nimport { QueryRef, QueryResult } from '../../api/query';\nimport {\n  QUERY_STR,\n  SerializedRef,\n  SOURCE_SERVER,\n  DataSource,\n  SOURCE_CACHE\n} from '../../api/Reference';\nimport { DataConnectSubscription } from '../../api.browser';\nimport { DataConnectCache, ServerValues } from '../../cache/Cache';\nimport { parseEntityIds } from '../../cache/cacheUtils';\nimport { EncodingMode } from '../../cache/EntityNode';\nimport { DataConnectTransport, Extensions } from '../../network';\nimport {\n  DataConnectExtensionWithMaxAge,\n  ExtensionsWithMaxAge\n} from '../../network/transport';\nimport { decoderImpl, encoderImpl } from '../../util/encoder';\nimport { Code, DataConnectError } from '../error';\n\nimport {\n  OnCompleteSubscription,\n  OnErrorSubscription,\n  OnResultSubscription\n} from './subscribe';\n\nexport function getRefSerializer<Data, Variables>(\n  queryRef: QueryRef<Data, Variables>,\n  data: Data,\n  source: DataSource,\n  fetchTime: string\n) {\n  return function toJSON(): SerializedRef<Data, Variables> {\n    return {\n      data,\n      refInfo: {\n        name: queryRef.name,\n        variables: queryRef.variables,\n        connectorConfig: {\n          projectId: queryRef.dataConnect.app.options.projectId!,\n          ...queryRef.dataConnect.getSettings()\n        }\n      },\n      fetchTime,\n      source\n    };\n  };\n}\n\nexport class QueryManager {\n  async preferCacheResults<Data, Variables>(\n    queryRef: QueryRef<Data, Variables>,\n    allowStale = false\n  ): Promise<QueryResult<Data, Variables>> {\n    let cacheResult: QueryResult<Data, Variables> | undefined;\n    try {\n      cacheResult = await this.fetchCacheResults(queryRef, allowStale);\n    } catch (e) {\n      // Ignore the error and try to fetch from the server.\n    }\n    if (cacheResult) {\n      return cacheResult;\n    }\n    return this.fetchServerResults(queryRef);\n  }\n  private callbacks = new Map<\n    string,\n    Array<DataConnectSubscription<unknown, unknown>>\n  >();\n  private subscriptionCache = new Map<string, QueryResult<unknown, unknown>>();\n  constructor(\n    private transport: DataConnectTransport,\n    private dc: DataConnect,\n    private cache?: DataConnectCache\n  ) {}\n  private queue: Array<Promise<unknown>> = [];\n  async waitForQueuedWrites(): Promise<void> {\n    for (const promise of this.queue) {\n      await promise;\n    }\n    this.queue = [];\n  }\n\n  updateSSR<Data, Variables>(updatedData: QueryResult<Data, Variables>): void {\n    this.queue.push(\n      this.updateCache(updatedData).then(async result =>\n        this.publishCacheResultsToSubscribers(result, updatedData.fetchTime)\n      )\n    );\n  }\n\n  async updateCache<Data, Variables>(\n    result: QueryResult<Data, Variables>,\n    extensions?: DataConnectExtensionWithMaxAge[]\n  ): Promise<string[]> {\n    await this.waitForQueuedWrites();\n    if (this.cache) {\n      const entityIds = parseEntityIds(result);\n      const updatedMaxAge = getMaxAgeFromExtensions(extensions);\n      if (updatedMaxAge !== undefined) {\n        this.cache.cacheSettings.maxAgeSeconds = updatedMaxAge;\n      }\n      return this.cache.update(\n        encoderImpl({\n          name: result.ref.name,\n          variables: result.ref.variables,\n          refType: QUERY_STR\n        }),\n        result.data as ServerValues,\n        entityIds\n      );\n    } else {\n      const key = encoderImpl({\n        name: result.ref.name,\n        variables: result.ref.variables,\n        refType: QUERY_STR\n      });\n      this.subscriptionCache.set(key, result);\n      return [key];\n    }\n  }\n\n  addSubscription<Data, Variables>(\n    queryRef: QueryRef<Data, Variables>,\n    onResultCallback: OnResultSubscription<Data, Variables>,\n    onCompleteCallback?: OnCompleteSubscription,\n    onErrorCallback?: OnErrorSubscription,\n    initialCache?: QueryResult<Data, Variables>\n  ): () => void {\n    const key = encoderImpl({\n      name: queryRef.name,\n      variables: queryRef.variables,\n      refType: QUERY_STR\n    });\n\n    const unsubscribe = (): void => {\n      if (this.callbacks.has(key)) {\n        const callbackList = this.callbacks.get(key)!;\n        this.callbacks.set(\n          key,\n          callbackList.filter(callback => callback !== subscription)\n        );\n        onCompleteCallback?.();\n      }\n    };\n    const subscription: DataConnectSubscription<Data, Variables> = {\n      userCallback: onResultCallback,\n      errCallback: onErrorCallback,\n      unsubscribe\n    };\n\n    if (initialCache) {\n      this.updateSSR(initialCache);\n    }\n\n    const promise = this.preferCacheResults(queryRef, /*allowStale=*/ true);\n    // We want to ignore the error and let subscriptions handle it\n    promise.then(undefined, err => {});\n\n    if (!this.callbacks.has(key)) {\n      this.callbacks.set(key, []);\n    }\n    this.callbacks\n      .get(key)!\n      .push(subscription as DataConnectSubscription<unknown, unknown>);\n\n    return unsubscribe;\n  }\n\n  async fetchServerResults<Data, Variables>(\n    queryRef: QueryRef<Data, Variables>\n  ): Promise<QueryResult<Data, Variables>> {\n    await this.waitForQueuedWrites();\n    const key = encoderImpl({\n      name: queryRef.name,\n      variables: queryRef.variables,\n      refType: QUERY_STR\n    });\n    try {\n      const result = await this.transport.invokeQuery<Data, Variables>(\n        queryRef.name,\n        queryRef.variables\n      );\n      const fetchTime = Date.now().toString();\n      const originalExtensions = result.extensions;\n      const queryResult: QueryResult<Data, Variables> = {\n        ...result,\n        ref: queryRef,\n        source: SOURCE_SERVER,\n        fetchTime,\n        data: result.data,\n        extensions: getDataConnectExtensionsWithoutMaxAge(originalExtensions),\n        toJSON: getRefSerializer(\n          queryRef,\n          result.data,\n          SOURCE_SERVER,\n          fetchTime\n        )\n      };\n      let updatedKeys: string[] = [];\n      updatedKeys = await this.updateCache(\n        queryResult,\n        originalExtensions?.dataConnect\n      );\n      this.publishDataToSubscribers(key, queryResult);\n      if (this.cache) {\n        await this.publishCacheResultsToSubscribers(updatedKeys, fetchTime);\n      } else {\n        this.subscriptionCache.set(key, queryResult);\n      }\n      return queryResult;\n    } catch (e) {\n      this.publishErrorToSubscribers(key, e);\n      throw e;\n    }\n  }\n\n  async fetchCacheResults<Data, Variables>(\n    queryRef: QueryRef<Data, Variables>,\n    allowStale = false\n  ): Promise<QueryResult<Data, Variables>> {\n    await this.waitForQueuedWrites();\n    let result: QueryResult<Data, Variables> | undefined | null;\n    if (!this.cache) {\n      result = await this.getFromSubscriberCache(queryRef);\n    } else {\n      result = await this.getFromResultTreeCache(queryRef, allowStale);\n    }\n    if (!result) {\n      throw new DataConnectError(\n        Code.OTHER,\n        'No cache entry found for query: ' + queryRef.name\n      );\n    }\n    const fetchTime = Date.now().toString();\n    const queryResult: QueryResult<Data, Variables> = {\n      ...result,\n      ref: queryRef,\n      source: SOURCE_CACHE,\n      fetchTime,\n      data: result.data,\n      extensions: result.extensions,\n      toJSON: getRefSerializer(queryRef, result.data, SOURCE_CACHE, fetchTime)\n    };\n    if (this.cache) {\n      const key = encoderImpl({\n        name: queryRef.name,\n        variables: queryRef.variables,\n        refType: QUERY_STR\n      });\n      await this.publishCacheResultsToSubscribers([key], fetchTime);\n    } else {\n      const key = encoderImpl({\n        name: queryRef.name,\n        variables: queryRef.variables,\n        refType: QUERY_STR\n      });\n      this.subscriptionCache.set(key, queryResult);\n      this.publishDataToSubscribers(key, queryResult);\n    }\n\n    return queryResult;\n  }\n\n  publishErrorToSubscribers(key: string, err: unknown): void {\n    this.callbacks.get(key)?.forEach(subscription => {\n      if (subscription.errCallback) {\n        subscription.errCallback(err as DataConnectError);\n      }\n    });\n  }\n\n  async getFromResultTreeCache<Data, Variables>(\n    queryRef: QueryRef<Data, Variables>,\n    allowStale = false\n  ): Promise<QueryResult<Data, Variables> | null> {\n    const key = encoderImpl({\n      name: queryRef.name,\n      variables: queryRef.variables,\n      refType: QUERY_STR\n    });\n    if (!this.cache || !(await this.cache.containsResultTree(key))) {\n      return null;\n    }\n    const cacheResult: Data = (await this.cache!.getResultJSON(key)) as Data;\n    const resultTree = await this.cache!.getResultTree(key);\n    if (!allowStale && resultTree!.isStale()) {\n      return null;\n    }\n    const result: QueryResult<Data, Variables> = {\n      source: SOURCE_CACHE,\n      ref: queryRef,\n      data: cacheResult,\n      toJSON: getRefSerializer(\n        queryRef,\n        cacheResult,\n        SOURCE_CACHE,\n        resultTree!.cachedAt.toString()\n      ),\n      fetchTime: resultTree!.cachedAt.toString()\n    };\n    (await this.cache!.getResultTree(key))!.updateAccessed();\n    return result;\n  }\n  async getFromSubscriberCache<Data, Variables>(\n    queryRef: QueryRef<Data, Variables>\n  ): Promise<QueryResult<Data, Variables> | undefined> {\n    const key = encoderImpl({\n      name: queryRef.name,\n      variables: queryRef.variables,\n      refType: QUERY_STR\n    });\n    if (!this.subscriptionCache.has(key)) {\n      return;\n    }\n    const result = this.subscriptionCache.get(key);\n    result!.source = SOURCE_CACHE;\n    result!.toJSON = getRefSerializer(\n      result!.ref,\n      result!.data,\n      SOURCE_CACHE,\n      result!.fetchTime\n    );\n    return result as QueryResult<Data, Variables>;\n  }\n\n  publishDataToSubscribers(\n    key: string,\n    queryResult: QueryResult<unknown, unknown>\n  ): void {\n    if (!this.callbacks.has(key)) {\n      return;\n    }\n    const subscribers = this.callbacks.get(key);\n    subscribers!.forEach(callback => {\n      callback.userCallback(queryResult);\n    });\n  }\n  async publishCacheResultsToSubscribers(\n    impactedQueries: string[],\n    fetchTime: string\n  ): Promise<void> {\n    if (!this.cache) {\n      return;\n    }\n    for (const query of impactedQueries) {\n      const callbacks = this.callbacks.get(query);\n      if (!callbacks) {\n        continue;\n      }\n      const newJson = (await this.cache.getResultTree(query))!\n        .getRootStub()\n        .toJSON(EncodingMode.hydrated);\n      const { name, variables } = decoderImpl(query) as unknown as QueryRef<\n        unknown,\n        unknown\n      >;\n      const queryRef: QueryRef<unknown, unknown> = {\n        dataConnect: this.dc,\n        refType: QUERY_STR,\n        name,\n        variables\n      };\n      this.publishDataToSubscribers(query, {\n        data: newJson,\n        fetchTime,\n        ref: queryRef,\n        source: SOURCE_CACHE,\n        toJSON: getRefSerializer(queryRef, newJson, SOURCE_CACHE, fetchTime)\n      });\n    }\n  }\n  enableEmulator(host: string, port: number): void {\n    this.transport.useEmulator(host, port);\n  }\n}\n\nexport function getMaxAgeFromExtensions(\n  extensions: DataConnectExtensionWithMaxAge[] | undefined\n): number | undefined {\n  if (!extensions) {\n    return;\n  }\n  for (const extension of extensions) {\n    if (\n      'maxAge' in extension &&\n      extension.maxAge !== undefined &&\n      extension.maxAge !== null\n    ) {\n      if (extension.maxAge.endsWith('s')) {\n        return Number(\n          extension.maxAge.substring(0, extension.maxAge.length - 1)\n        );\n      }\n    }\n  }\n}\nfunction getDataConnectExtensionsWithoutMaxAge(\n  extensions: ExtensionsWithMaxAge\n): Extensions | undefined {\n  return {\n    dataConnect: extensions.dataConnect?.filter(\n      extension => 'entityId' in extension || 'entityIds' in extension\n    )\n  };\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataConnectOptions, TransportOptions } from '../../api/DataConnect';\nimport { AppCheckTokenProvider } from '../../core/AppCheckTokenProvider';\nimport { AuthTokenProvider } from '../../core/FirebaseAuthProvider';\n\n/**\n * enum representing different flavors of the SDK used by developers\n * use the CallerSdkType for type-checking, and the CallerSdkTypeEnum for value-checking/assigning\n */\nexport type CallerSdkType =\n  | 'Base' // Core JS SDK\n  | 'Generated' // Generated JS SDK\n  | 'TanstackReactCore' // Tanstack non-generated React SDK\n  | 'GeneratedReact' // Generated React SDK\n  | 'TanstackAngularCore' // Tanstack non-generated Angular SDK\n  | 'GeneratedAngular'; // Generated Angular SDK\nexport const CallerSdkTypeEnum = {\n  Base: 'Base', // Core JS SDK\n  Generated: 'Generated', // Generated JS SDK\n  TanstackReactCore: 'TanstackReactCore', // Tanstack non-generated React SDK\n  GeneratedReact: 'GeneratedReact', // Tanstack non-generated Angular SDK\n  TanstackAngularCore: 'TanstackAngularCore', // Tanstack non-generated Angular SDK\n  GeneratedAngular: 'GeneratedAngular' // Generated Angular SDK\n} as const;\n\nexport interface DataConnectEntityArray {\n  entityIds: string[];\n}\n\nexport interface DataConnectSingleEntity {\n  entityId: string;\n}\n\nexport type DataConnectExtension = {\n  path: Array<string | number>;\n} & (DataConnectEntityArray | DataConnectSingleEntity);\n\n/** @internal */\nexport interface DataConnectMaxAge {\n  maxAge: string;\n}\n\n/** @internal */\nexport type DataConnectExtensionWithMaxAge = {\n  path: Array<string | number>;\n} & (DataConnectEntityArray | DataConnectSingleEntity | DataConnectMaxAge);\n\nexport interface Extensions {\n  dataConnect?: DataConnectExtension[];\n}\n\n/** @internal */\nexport interface ExtensionsWithMaxAge {\n  dataConnect?: DataConnectExtensionWithMaxAge[];\n}\n\nexport interface DataConnectResponse<T> {\n  data: T;\n  errors: Error[];\n  extensions: Extensions;\n}\n\n/** @internal */\nexport interface DataConnectResponseWithMaxAge<T> {\n  data: T;\n  errors: Error[];\n  extensions: ExtensionsWithMaxAge;\n}\n\n/**\n * @internal\n */\nexport interface DataConnectTransport {\n  invokeQuery<T, U>(\n    queryName: string,\n    body?: U\n  ): Promise<DataConnectResponseWithMaxAge<T>>;\n  invokeMutation<T, U>(\n    queryName: string,\n    body?: U\n  ): Promise<DataConnectResponse<T>>;\n  useEmulator(host: string, port?: number, sslEnabled?: boolean): void;\n  onTokenChanged: (token: string | null) => void;\n  _setCallerSdkType(callerSdkType: CallerSdkType): void;\n}\n\n/**\n * @internal\n */\nexport type TransportClass = new (\n  options: DataConnectOptions,\n  apiKey?: string,\n  appId?: string,\n  authProvider?: AuthTokenProvider,\n  appCheckProvider?: AppCheckTokenProvider,\n  transportOptions?: TransportOptions,\n  _isUsingGen?: boolean,\n  _callerSdkType?: CallerSdkType\n) => DataConnectTransport;\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataConnectOptions, TransportOptions } from '../api/DataConnect';\nimport { Code, DataConnectError } from '../core/error';\nimport { logError } from '../logger';\n\nexport const PROD_HOST = 'firebasedataconnect.googleapis.com';\n\nexport function urlBuilder(\n  projectConfig: DataConnectOptions,\n  transportOptions: TransportOptions\n): string {\n  const { connector, location, projectId: project, service } = projectConfig;\n  const { host, sslEnabled, port } = transportOptions;\n  const protocol = sslEnabled ? 'https' : 'http';\n  const realHost = host || PROD_HOST;\n  let baseUrl = `${protocol}://${realHost}`;\n  if (typeof port === 'number') {\n    baseUrl += `:${port}`;\n  } else if (typeof port !== 'undefined') {\n    logError('Port type is of an invalid type');\n    throw new DataConnectError(\n      Code.INVALID_ARGUMENT,\n      'Incorrect type for port passed in!'\n    );\n  }\n  return `${baseUrl}/v1/projects/${project}/locations/${location}/services/${service}/connectors/${connector}`;\n}\nexport function addToken(url: string, apiKey?: string): string {\n  if (!apiKey) {\n    return url;\n  }\n  const newUrl = new URL(url);\n  newUrl.searchParams.append('key', apiKey);\n  return newUrl.toString();\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { isCloudWorkstation } from '@firebase/util';\n\nimport {\n  Code,\n  DataConnectError,\n  DataConnectOperationError,\n  DataConnectOperationFailureResponse\n} from '../core/error';\nimport { SDK_VERSION } from '../core/version';\nimport { logError } from '../logger';\n\nimport {\n  CallerSdkType,\n  CallerSdkTypeEnum,\n  Extensions,\n  DataConnectResponse\n} from './transport';\n\nlet connectFetch: typeof fetch | null = globalThis.fetch;\nexport function initializeFetch(fetchImpl: typeof fetch): void {\n  connectFetch = fetchImpl;\n}\nfunction getGoogApiClientValue(\n  _isUsingGen: boolean,\n  _callerSdkType: CallerSdkType\n): string {\n  let str = 'gl-js/ fire/' + SDK_VERSION;\n  if (\n    _callerSdkType !== CallerSdkTypeEnum.Base &&\n    _callerSdkType !== CallerSdkTypeEnum.Generated\n  ) {\n    str += ' js/' + _callerSdkType.toLowerCase();\n  } else if (_isUsingGen || _callerSdkType === CallerSdkTypeEnum.Generated) {\n    str += ' js/gen';\n  }\n  return str;\n}\nexport interface DataConnectFetchBody<T> {\n  name: string;\n  operationName: string;\n  variables: T;\n}\nexport async function dcFetch<T, U>(\n  url: string,\n  body: DataConnectFetchBody<U>,\n  { signal }: AbortController,\n  appId: string | null | undefined,\n  accessToken: string | null,\n  appCheckToken: string | null | undefined,\n  _isUsingGen: boolean,\n  _callerSdkType: CallerSdkType,\n  _isUsingEmulator: boolean\n): Promise<DataConnectResponse<T>> {\n  if (!connectFetch) {\n    throw new DataConnectError(Code.OTHER, 'No Fetch Implementation detected!');\n  }\n  const headers: HeadersInit = {\n    'Content-Type': 'application/json',\n    'X-Goog-Api-Client': getGoogApiClientValue(_isUsingGen, _callerSdkType)\n  };\n  if (accessToken) {\n    headers['X-Firebase-Auth-Token'] = accessToken;\n  }\n  if (appId) {\n    headers['x-firebase-gmpid'] = appId;\n  }\n  if (appCheckToken) {\n    headers['X-Firebase-AppCheck'] = appCheckToken;\n  }\n  const bodyStr = JSON.stringify(body);\n  const fetchOptions: RequestInit = {\n    body: bodyStr,\n    method: 'POST',\n    headers,\n    signal\n  };\n  if (isCloudWorkstation(url) && _isUsingEmulator) {\n    fetchOptions.credentials = 'include';\n  }\n\n  let response: Response;\n  try {\n    response = await connectFetch(url, fetchOptions);\n  } catch (err) {\n    throw new DataConnectError(\n      Code.OTHER,\n      'Failed to fetch: ' + JSON.stringify(err)\n    );\n  }\n  let jsonResponse: JsonResponse<T>;\n  try {\n    jsonResponse = await response.json();\n  } catch (e) {\n    throw new DataConnectError(Code.OTHER, JSON.stringify(e));\n  }\n  const message = getErrorMessage(jsonResponse);\n  if (response.status >= 400) {\n    logError('Error while performing request: ' + JSON.stringify(jsonResponse));\n    if (response.status === 401) {\n      throw new DataConnectError(Code.UNAUTHORIZED, message);\n    }\n    throw new DataConnectError(Code.OTHER, message);\n  }\n  if (jsonResponse.errors && jsonResponse.errors.length) {\n    const stringified = JSON.stringify(jsonResponse.errors);\n    const failureResponse: DataConnectOperationFailureResponse = {\n      errors: jsonResponse.errors,\n      data: jsonResponse.data as Record<string, unknown>\n    };\n    throw new DataConnectOperationError(\n      'DataConnect error while performing request: ' + stringified,\n      failureResponse\n    );\n  }\n  if (!jsonResponse.extensions) {\n    jsonResponse.extensions = {\n      dataConnect: []\n    };\n  }\n  return jsonResponse as DataConnectResponse<T>;\n}\ninterface JsonResponse<T> {\n  message?: string;\n  errors: [];\n  data: Record<string, unknown> | T | null;\n  extensions?: Extensions;\n}\nfunction getErrorMessage(obj: JsonResponse<unknown>): string {\n  if ('message' in obj && obj.message) {\n    return obj.message;\n  }\n  return JSON.stringify(obj);\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataConnectOptions, TransportOptions } from '../../api/DataConnect';\nimport { AppCheckTokenProvider } from '../../core/AppCheckTokenProvider';\nimport { DataConnectError, Code } from '../../core/error';\nimport { AuthTokenProvider } from '../../core/FirebaseAuthProvider';\nimport { logDebug } from '../../logger';\nimport { addToken, urlBuilder } from '../../util/url';\nimport { dcFetch } from '../fetch';\n\nimport {\n  CallerSdkType,\n  CallerSdkTypeEnum,\n  DataConnectResponse,\n  DataConnectTransport\n} from '.';\n\nexport class RESTTransport implements DataConnectTransport {\n  private _host = '';\n  private _port: number | undefined;\n  private _location = 'l';\n  private _connectorName = '';\n  private _secure = true;\n  private _project = 'p';\n  private _serviceName: string;\n  private _accessToken: string | null = null;\n  private _appCheckToken: string | null | undefined = null;\n  private _lastToken: string | null = null;\n  private _isUsingEmulator = false;\n  constructor(\n    options: DataConnectOptions,\n    private apiKey?: string | undefined,\n    private appId?: string | null,\n    private authProvider?: AuthTokenProvider | undefined,\n    private appCheckProvider?: AppCheckTokenProvider | undefined,\n    transportOptions?: TransportOptions | undefined,\n    private _isUsingGen = false,\n    private _callerSdkType: CallerSdkType = CallerSdkTypeEnum.Base\n  ) {\n    if (transportOptions) {\n      if (typeof transportOptions.port === 'number') {\n        this._port = transportOptions.port;\n      }\n      if (typeof transportOptions.sslEnabled !== 'undefined') {\n        this._secure = transportOptions.sslEnabled;\n      }\n      this._host = transportOptions.host;\n    }\n    const { location, projectId: project, connector, service } = options;\n    if (location) {\n      this._location = location;\n    }\n    if (project) {\n      this._project = project;\n    }\n    this._serviceName = service;\n    if (!connector) {\n      throw new DataConnectError(\n        Code.INVALID_ARGUMENT,\n        'Connector Name required!'\n      );\n    }\n    this._connectorName = connector;\n    this.authProvider?.addTokenChangeListener(token => {\n      logDebug(`New Token Available: ${token}`);\n      this._accessToken = token;\n    });\n    this.appCheckProvider?.addTokenChangeListener(result => {\n      const { token } = result;\n      logDebug(`New App Check Token Available: ${token}`);\n      this._appCheckToken = token;\n    });\n  }\n  get endpointUrl(): string {\n    return urlBuilder(\n      {\n        connector: this._connectorName,\n        location: this._location,\n        projectId: this._project,\n        service: this._serviceName\n      },\n      { host: this._host, sslEnabled: this._secure, port: this._port }\n    );\n  }\n  useEmulator(host: string, port?: number, isSecure?: boolean): void {\n    this._host = host;\n    this._isUsingEmulator = true;\n    if (typeof port === 'number') {\n      this._port = port;\n    }\n    if (typeof isSecure !== 'undefined') {\n      this._secure = isSecure;\n    }\n  }\n  onTokenChanged(newToken: string | null): void {\n    this._accessToken = newToken;\n  }\n\n  async getWithAuth(forceToken = false): Promise<string | null> {\n    let starterPromise: Promise<string | null> = new Promise(resolve =>\n      resolve(this._accessToken)\n    );\n    if (this.appCheckProvider) {\n      const appCheckToken = await this.appCheckProvider.getToken();\n      if (appCheckToken) {\n        this._appCheckToken = appCheckToken.token;\n      }\n    }\n    if (this.authProvider) {\n      starterPromise = this.authProvider\n        .getToken(/*forceToken=*/ forceToken)\n        .then(data => {\n          if (!data) {\n            return null;\n          }\n          this._accessToken = data.accessToken;\n          return this._accessToken;\n        });\n    } else {\n      starterPromise = new Promise(resolve => resolve(''));\n    }\n    return starterPromise;\n  }\n\n  _setLastToken(lastToken: string | null): void {\n    this._lastToken = lastToken;\n  }\n\n  withRetry<T>(\n    promiseFactory: () => Promise<DataConnectResponse<T>>,\n    retry = false\n  ): Promise<DataConnectResponse<T>> {\n    let isNewToken = false;\n    return this.getWithAuth(retry)\n      .then(res => {\n        isNewToken = this._lastToken !== res;\n        this._lastToken = res;\n        return res;\n      })\n      .then(promiseFactory)\n      .catch(err => {\n        // Only retry if the result is unauthorized and the last token isn't the same as the new one.\n        if (\n          'code' in err &&\n          err.code === Code.UNAUTHORIZED &&\n          !retry &&\n          isNewToken\n        ) {\n          logDebug('Retrying due to unauthorized');\n          return this.withRetry(promiseFactory, true);\n        }\n        throw err;\n      });\n  }\n\n  // TODO(mtewani): Update U to include shape of body defined in line 13.\n  invokeQuery: <T, U>(\n    queryName: string,\n    body?: U\n  ) => Promise<DataConnectResponse<T>> = <T, U = unknown>(\n    queryName: string,\n    body: U\n  ) => {\n    const abortController = new AbortController();\n\n    // TODO(mtewani): Update to proper value\n    const withAuth = this.withRetry(() =>\n      dcFetch<T, U>(\n        addToken(`${this.endpointUrl}:executeQuery`, this.apiKey),\n        {\n          name: `projects/${this._project}/locations/${this._location}/services/${this._serviceName}/connectors/${this._connectorName}`,\n          operationName: queryName,\n          variables: body\n        },\n        abortController,\n        this.appId,\n        this._accessToken,\n        this._appCheckToken,\n        this._isUsingGen,\n        this._callerSdkType,\n        this._isUsingEmulator\n      )\n    );\n    return withAuth;\n  };\n  invokeMutation: <T, U>(\n    queryName: string,\n    body?: U\n  ) => Promise<DataConnectResponse<T>> = <T, U = unknown>(\n    mutationName: string,\n    body: U\n  ) => {\n    const abortController = new AbortController();\n    const taskResult = this.withRetry(() => {\n      return dcFetch<T, U>(\n        addToken(`${this.endpointUrl}:executeMutation`, this.apiKey),\n        {\n          name: `projects/${this._project}/locations/${this._location}/services/${this._serviceName}/connectors/${this._connectorName}`,\n          operationName: mutationName,\n          variables: body\n        },\n        abortController,\n        this.appId,\n        this._accessToken,\n        this._appCheckToken,\n        this._isUsingGen,\n        this._callerSdkType,\n        this._isUsingEmulator\n      );\n    });\n    return taskResult;\n  };\n\n  _setCallerSdkType(callerSdkType: CallerSdkType): void {\n    this._callerSdkType = callerSdkType;\n  }\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { DataConnectTransport } from '../network/transport';\n\nimport { DataConnect } from './DataConnect';\nimport {\n  DataConnectResult,\n  MUTATION_STR,\n  OperationRef,\n  SOURCE_SERVER\n} from './Reference';\n\nexport interface MutationRef<Data, Variables>\n  extends OperationRef<Data, Variables> {\n  refType: typeof MUTATION_STR;\n}\n\n/**\n * Creates a `MutationRef`\n * @param dcInstance Data Connect instance\n * @param mutationName name of mutation\n */\nexport function mutationRef<Data>(\n  dcInstance: DataConnect,\n  mutationName: string\n): MutationRef<Data, undefined>;\n/**\n *\n * @param dcInstance Data Connect instance\n * @param mutationName name of mutation\n * @param variables variables to send with mutation\n */\nexport function mutationRef<Data, Variables>(\n  dcInstance: DataConnect,\n  mutationName: string,\n  variables: Variables\n): MutationRef<Data, Variables>;\n/**\n *\n * @param dcInstance Data Connect instance\n * @param mutationName name of mutation\n * @param variables variables to send with mutation\n * @returns `MutationRef`\n */\nexport function mutationRef<Data, Variables>(\n  dcInstance: DataConnect,\n  mutationName: string,\n  variables?: Variables\n): MutationRef<Data, Variables> {\n  dcInstance.setInitialized();\n  const ref: MutationRef<Data, Variables> = {\n    dataConnect: dcInstance,\n    name: mutationName,\n    refType: MUTATION_STR,\n    variables: variables as Variables\n  };\n  return ref;\n}\n\n/**\n * @internal\n */\nexport class MutationManager {\n  private _inflight: Array<Promise<unknown>> = [];\n  constructor(private _transport: DataConnectTransport) {}\n  executeMutation<Data, Variables>(\n    mutationRef: MutationRef<Data, Variables>\n  ): MutationPromise<Data, Variables> {\n    const result = this._transport.invokeMutation<Data, Variables>(\n      mutationRef.name,\n      mutationRef.variables\n    );\n    const withRefPromise = result.then(res => {\n      const obj: MutationResult<Data, Variables> = {\n        ...res, // Double check that the result is result.data, not just result\n        source: SOURCE_SERVER,\n        ref: mutationRef,\n        fetchTime: Date.now().toLocaleString()\n      };\n      return obj;\n    });\n    this._inflight.push(result);\n    const removePromise = (): Array<Promise<unknown>> =>\n      (this._inflight = this._inflight.filter(promise => promise !== result));\n    result.then(removePromise, removePromise);\n    return withRefPromise;\n  }\n}\n\n/**\n * Mutation Result from `executeMutation`\n */\nexport interface MutationResult<Data, Variables>\n  extends DataConnectResult<Data, Variables> {\n  ref: MutationRef<Data, Variables>;\n}\n/**\n * Mutation return value from `executeMutation`\n */\nexport interface MutationPromise<Data, Variables>\n  extends Promise<MutationResult<Data, Variables>> {\n  // reserved for special actions like cancellation\n}\n\n/**\n * Execute Mutation\n * @param mutationRef mutation to execute\n * @returns `MutationRef`\n */\nexport function executeMutation<Data, Variables>(\n  mutationRef: MutationRef<Data, Variables>\n): MutationPromise<Data, Variables> {\n  return mutationRef.dataConnect._mutationManager.executeMutation(mutationRef);\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  FirebaseApp,\n  _getProvider,\n  _removeServiceInstance,\n  getApp\n} from '@firebase/app';\nimport { AppCheckInternalComponentName } from '@firebase/app-check-interop-types';\nimport { FirebaseAuthInternalName } from '@firebase/auth-interop-types';\nimport { Provider } from '@firebase/component';\nimport {\n  isCloudWorkstation,\n  pingServer,\n  updateEmulatorBanner\n} from '@firebase/util';\n\nimport { DataConnectCache, MemoryStub } from '../cache/Cache';\nimport { InternalCacheProvider } from '../cache/CacheProvider';\nimport { AppCheckTokenProvider } from '../core/AppCheckTokenProvider';\nimport { Code, DataConnectError } from '../core/error';\nimport {\n  AuthTokenProvider,\n  FirebaseAuthProvider\n} from '../core/FirebaseAuthProvider';\nimport { QueryManager } from '../core/query/QueryManager';\nimport { logDebug, logError } from '../logger';\nimport {\n  CallerSdkType,\n  CallerSdkTypeEnum,\n  DataConnectTransport,\n  TransportClass\n} from '../network';\nimport { RESTTransport } from '../network/transport/rest';\nimport { PROD_HOST } from '../util/url';\n\nimport { MutationManager } from './Mutation';\n\n/**\n * Connector Config for calling Data Connect backend.\n */\nexport interface ConnectorConfig {\n  location: string;\n  connector: string;\n  service: string;\n}\n\n/**\n * Options to connect to emulator\n */\nexport interface TransportOptions {\n  host: string;\n  sslEnabled?: boolean;\n  port?: number;\n}\n\nconst FIREBASE_DATA_CONNECT_EMULATOR_HOST_VAR =\n  'FIREBASE_DATA_CONNECT_EMULATOR_HOST';\n\n/**\n *\n * @param fullHost\n * @returns TransportOptions\n * @internal\n */\nexport function parseOptions(fullHost: string): TransportOptions {\n  const [protocol, hostName] = fullHost.split('://');\n  const isSecure = protocol === 'https';\n  const [host, portAsString] = hostName.split(':');\n  const port = Number(portAsString);\n  return { host, port, sslEnabled: isSecure };\n}\n/**\n * DataConnectOptions including project id\n */\nexport interface DataConnectOptions extends ConnectorConfig {\n  projectId: string;\n}\n\n/**\n * Class representing Firebase Data Connect\n */\nexport class DataConnect {\n  _queryManager!: QueryManager;\n  _mutationManager!: MutationManager;\n  isEmulator = false;\n  _initialized = false;\n  private _transport!: DataConnectTransport;\n  private _transportClass: TransportClass | undefined;\n  private _transportOptions?: TransportOptions;\n  private _authTokenProvider?: AuthTokenProvider;\n  _isUsingGeneratedSdk: boolean = false;\n  _callerSdkType: CallerSdkType = CallerSdkTypeEnum.Base;\n  private _appCheckTokenProvider?: AppCheckTokenProvider;\n  private _cacheSettings?: CacheSettings;\n  /**\n   * @internal\n   */\n  private cache?: DataConnectCache;\n  // @internal\n  constructor(\n    public readonly app: FirebaseApp,\n    // TODO(mtewani): Replace with _dataConnectOptions in the future\n    private readonly dataConnectOptions: DataConnectOptions,\n    private readonly _authProvider: Provider<FirebaseAuthInternalName>,\n    private readonly _appCheckProvider: Provider<AppCheckInternalComponentName>\n  ) {\n    if (typeof process !== 'undefined' && process.env) {\n      const host = process.env[FIREBASE_DATA_CONNECT_EMULATOR_HOST_VAR];\n      if (host) {\n        logDebug('Found custom host. Using emulator');\n        this.isEmulator = true;\n        this._transportOptions = parseOptions(host);\n      }\n    }\n  }\n  /**\n   * @internal\n   */\n  getCache(): DataConnectCache | undefined {\n    return this.cache;\n  }\n  // @internal\n  _useGeneratedSdk(): void {\n    if (!this._isUsingGeneratedSdk) {\n      this._isUsingGeneratedSdk = true;\n    }\n  }\n  _setCallerSdkType(callerSdkType: CallerSdkType): void {\n    this._callerSdkType = callerSdkType;\n    if (this._initialized) {\n      this._transport._setCallerSdkType(callerSdkType);\n    }\n  }\n  _delete(): Promise<void> {\n    _removeServiceInstance(\n      this.app,\n      'data-connect',\n      JSON.stringify(this.getSettings())\n    );\n    return Promise.resolve();\n  }\n\n  // @internal\n  getSettings(): ConnectorConfig {\n    const copy = JSON.parse(JSON.stringify(this.dataConnectOptions));\n    delete copy.projectId;\n    return copy;\n  }\n\n  /**\n   * @internal\n   */\n  setCacheSettings(cacheSettings: CacheSettings): void {\n    this._cacheSettings = cacheSettings;\n  }\n\n  // @internal\n  setInitialized(): void {\n    if (this._initialized) {\n      return;\n    }\n    if (this._transportClass === undefined) {\n      logDebug('transportClass not provided. Defaulting to RESTTransport.');\n      this._transportClass = RESTTransport;\n    }\n\n    this._authTokenProvider = new FirebaseAuthProvider(\n      this.app.name,\n      this.app.options,\n      this._authProvider\n    );\n    const connectorConfig: ConnectorConfig = {\n      connector: this.dataConnectOptions.connector,\n      service: this.dataConnectOptions.service,\n      location: this.dataConnectOptions.location\n    };\n    if (this._cacheSettings) {\n      this.cache = new DataConnectCache(\n        this._authTokenProvider,\n        this.app.options.projectId!,\n        connectorConfig,\n        this._transportOptions?.host || PROD_HOST,\n        this._cacheSettings\n      );\n    }\n\n    if (this._appCheckProvider) {\n      this._appCheckTokenProvider = new AppCheckTokenProvider(\n        this.app,\n        this._appCheckProvider\n      );\n    }\n\n    this._transport = new this._transportClass(\n      this.dataConnectOptions,\n      this.app.options.apiKey,\n      this.app.options.appId,\n      this._authTokenProvider,\n      this._appCheckTokenProvider,\n      undefined,\n      this._isUsingGeneratedSdk,\n      this._callerSdkType\n    );\n    if (this._transportOptions) {\n      this._transport.useEmulator(\n        this._transportOptions.host,\n        this._transportOptions.port,\n        this._transportOptions.sslEnabled\n      );\n    }\n\n    this._queryManager = new QueryManager(this._transport, this, this.cache);\n    this._mutationManager = new MutationManager(this._transport);\n    this._initialized = true;\n  }\n\n  // @internal\n  enableEmulator(transportOptions: TransportOptions): void {\n    if (\n      this._transportOptions &&\n      this._initialized &&\n      !areTransportOptionsEqual(this._transportOptions, transportOptions)\n    ) {\n      logError('enableEmulator called after initialization');\n      throw new DataConnectError(\n        Code.ALREADY_INITIALIZED,\n        'DataConnect instance already initialized!'\n      );\n    }\n    this._transportOptions = transportOptions;\n    this.isEmulator = true;\n  }\n}\n\n/**\n * @internal\n * @param transportOptions1\n * @param transportOptions2\n * @returns\n */\nexport function areTransportOptionsEqual(\n  transportOptions1: TransportOptions,\n  transportOptions2: TransportOptions\n): boolean {\n  return (\n    transportOptions1.host === transportOptions2.host &&\n    transportOptions1.port === transportOptions2.port &&\n    transportOptions1.sslEnabled === transportOptions2.sslEnabled\n  );\n}\n\n/**\n * Connect to the DataConnect Emulator\n * @param dc Data Connect instance\n * @param host host of emulator server\n * @param port port of emulator server\n * @param sslEnabled use https\n */\nexport function connectDataConnectEmulator(\n  dc: DataConnect,\n  host: string,\n  port?: number,\n  sslEnabled = false\n): void {\n  // Workaround to get cookies in Firebase Studio\n  if (isCloudWorkstation(host)) {\n    void pingServer(`https://${host}${port ? `:${port}` : ''}`);\n    updateEmulatorBanner('Data Connect', true);\n  }\n  dc.enableEmulator({ host, port, sslEnabled });\n}\n\nexport interface DataConnectSettings {\n  cacheSettings?: CacheSettings;\n}\n\n/**\n * Initialize DataConnect instance\n * @param options ConnectorConfig\n */\nexport function getDataConnect(\n  options: ConnectorConfig,\n  settings?: DataConnectSettings\n): DataConnect;\nexport function getDataConnect(options: ConnectorConfig): DataConnect;\n/**\n * Initialize DataConnect instance\n * @param app FirebaseApp to initialize to.\n * @param connectorConfig ConnectorConfig\n */\nexport function getDataConnect(\n  app: FirebaseApp,\n  connectorConfig: ConnectorConfig\n): DataConnect;\n\n/**\n * Initialize DataConnect instance\n * @param app FirebaseApp to initialize to.\n * @param connectorConfig ConnectorConfig\n */\nexport function getDataConnect(\n  app: FirebaseApp,\n  connectorConfig: ConnectorConfig,\n  settings: DataConnectSettings\n): DataConnect;\n\nexport function getDataConnect(\n  appOrConnectorConfig: FirebaseApp | ConnectorConfig,\n  settingsOrConnectorConfig?: ConnectorConfig | DataConnectSettings,\n  settings?: DataConnectSettings\n): DataConnect {\n  let app: FirebaseApp;\n  let connectorConfig: ConnectorConfig;\n  let realSettings: DataConnectSettings;\n  if ('location' in appOrConnectorConfig) {\n    connectorConfig = appOrConnectorConfig;\n    app = getApp();\n    realSettings = settingsOrConnectorConfig as DataConnectSettings;\n  } else {\n    app = appOrConnectorConfig;\n    connectorConfig = settingsOrConnectorConfig as ConnectorConfig;\n    realSettings = settings as DataConnectSettings;\n  }\n\n  if (!app || Object.keys(app).length === 0) {\n    app = getApp();\n  }\n\n  // Options to store in Firebase Component Provider.\n  const serializedOptions = {\n    ...connectorConfig,\n    projectId: app.options.projectId\n  };\n\n  // We should sort the keys before initialization.\n  const sortedSerialized = Object.fromEntries(\n    Object.entries(serializedOptions).sort()\n  );\n\n  const provider = _getProvider(app, 'data-connect');\n  const identifier = JSON.stringify(sortedSerialized);\n  if (provider.isInitialized(identifier)) {\n    const dcInstance = provider.getImmediate({ identifier });\n    const options = provider.getOptions(identifier);\n    const optionsValid = Object.keys(options).length > 0;\n    if (optionsValid) {\n      logDebug('Re-using cached instance');\n      return dcInstance;\n    }\n  }\n  validateDCOptions(connectorConfig);\n\n  logDebug('Creating new DataConnect instance');\n  // Initialize with options.\n  const dataConnect = provider.initialize({\n    instanceIdentifier: identifier,\n    options: Object.fromEntries(\n      Object.entries({\n        ...sortedSerialized\n      }).sort()\n    )\n  });\n  if (realSettings?.cacheSettings) {\n    dataConnect.setCacheSettings(realSettings.cacheSettings);\n  }\n  return dataConnect;\n}\n\n/**\n *\n * @param dcOptions\n * @returns {void}\n * @internal\n */\nexport function validateDCOptions(dcOptions: ConnectorConfig): boolean {\n  const fields = ['connector', 'location', 'service'];\n  if (!dcOptions) {\n    throw new DataConnectError(Code.INVALID_ARGUMENT, 'DC Option Required');\n  }\n  fields.forEach(field => {\n    if (\n      dcOptions[field as keyof ConnectorConfig] === null ||\n      dcOptions[field as keyof ConnectorConfig] === undefined\n    ) {\n      throw new DataConnectError(Code.INVALID_ARGUMENT, `${field} Required`);\n    }\n  });\n  return true;\n}\n\n/**\n * Delete DataConnect instance\n * @param dataConnect DataConnect instance\n * @returns\n */\nexport function terminate(dataConnect: DataConnect): Promise<void> {\n  return dataConnect._delete();\n  // TODO(mtewani): Stop pending tasks\n}\nexport const StorageType = {\n  MEMORY: 'MEMORY'\n} as const;\n\nexport type StorageType = (typeof StorageType)[keyof typeof StorageType];\n\nexport interface CacheSettings {\n  cacheProvider: CacheProvider<StorageType>;\n  maxAgeSeconds?: number;\n}\nexport interface CacheProvider<T extends StorageType> {\n  type: T;\n  /**\n   * @internal\n   */\n  initialize(cacheId: string): InternalCacheProvider;\n}\n\nexport function makeMemoryCacheProvider(): CacheProvider<'MEMORY'> {\n  return new MemoryStub();\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport const QueryFetchPolicy = {\n  PREFER_CACHE: 'PREFER_CACHE',\n  CACHE_ONLY: 'CACHE_ONLY',\n  SERVER_ONLY: 'SERVER_ONLY'\n} as const;\n\n/*\n * Represents policy for how executeQuery fetches data\n *\n */\nexport type QueryFetchPolicy =\n  (typeof QueryFetchPolicy)[keyof typeof QueryFetchPolicy];\n\nexport interface ExecuteQueryOptions {\n  fetchPolicy: QueryFetchPolicy;\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Code, DataConnectError } from '../core/error';\nimport {\n  ExecuteQueryOptions,\n  QueryFetchPolicy\n} from '../core/query/queryOptions';\nimport { DataConnectExtensionWithMaxAge } from '../network/transport';\n\nimport { DataConnect, getDataConnect } from './DataConnect';\nimport {\n  OperationRef,\n  QUERY_STR,\n  DataConnectResult,\n  SerializedRef\n} from './Reference';\n\n/**\n * QueryRef object\n */\nexport interface QueryRef<Data, Variables>\n  extends OperationRef<Data, Variables> {\n  refType: typeof QUERY_STR;\n}\n\n/** @internal */\nexport type InternalQueryResult<Data, Variables> = QueryResult<\n  Data,\n  Variables\n> &\n  Omit<DataConnectResult<Data, Variables>, 'extensions'> & {\n    extensions?: {\n      dataConnect?: DataConnectExtensionWithMaxAge[];\n    };\n  };\n\n/**\n * Result of `executeQuery`\n */\nexport interface QueryResult<Data, Variables>\n  extends DataConnectResult<Data, Variables> {\n  ref: QueryRef<Data, Variables>;\n  toJSON: () => SerializedRef<Data, Variables>;\n}\n/**\n * Promise returned from `executeQuery`\n */\nexport interface QueryPromise<Data, Variables>\n  extends Promise<QueryResult<Data, Variables>> {\n  // reserved for special actions like cancellation\n}\n\n/**\n * Execute Query\n * @param queryRef query to execute.\n * @returns `QueryPromise`\n */\nexport function executeQuery<Data, Variables>(\n  queryRef: QueryRef<Data, Variables>,\n  options?: ExecuteQueryOptions\n): QueryPromise<Data, Variables> {\n  if (queryRef.refType !== QUERY_STR) {\n    return Promise.reject(\n      new DataConnectError(\n        Code.INVALID_ARGUMENT,\n        `ExecuteQuery can only execute query operations`\n      )\n    );\n  }\n  const queryManager = queryRef.dataConnect._queryManager;\n  const fetchPolicy = options?.fetchPolicy ?? QueryFetchPolicy.PREFER_CACHE;\n  switch (fetchPolicy) {\n    case QueryFetchPolicy.SERVER_ONLY:\n      return queryManager.fetchServerResults(queryRef);\n    case QueryFetchPolicy.CACHE_ONLY:\n      return queryManager.fetchCacheResults(queryRef, true);\n    case QueryFetchPolicy.PREFER_CACHE:\n      return queryManager.preferCacheResults(queryRef, false);\n    default:\n      throw new DataConnectError(\n        Code.INVALID_ARGUMENT,\n        `Invalid fetch policy: ${fetchPolicy}`\n      );\n  }\n}\n\n/**\n * Execute Query\n * @param dcInstance Data Connect instance to use.\n * @param queryName Query to execute\n * @returns `QueryRef`\n */\nexport function queryRef<Data>(\n  dcInstance: DataConnect,\n  queryName: string\n): QueryRef<Data, undefined>;\n/**\n * Execute Query\n * @param dcInstance Data Connect instance to use.\n * @param queryName Query to execute\n * @param variables Variables to execute with\n * @returns `QueryRef`\n */\nexport function queryRef<Data, Variables>(\n  dcInstance: DataConnect,\n  queryName: string,\n  variables: Variables\n): QueryRef<Data, Variables>;\n/**\n * Execute Query\n * @param dcInstance Data Connect instance to use.\n * @param queryName Query to execute\n * @param variables Variables to execute with\n * @param initialCache initial cache to use for client hydration\n * @returns `QueryRef`\n */\nexport function queryRef<Data, Variables>(\n  dcInstance: DataConnect,\n  queryName: string,\n  variables?: Variables,\n  initialCache?: QueryResult<Data, Variables>\n): QueryRef<Data, Variables> {\n  dcInstance.setInitialized();\n  if (initialCache !== undefined) {\n    dcInstance._queryManager.updateSSR(initialCache);\n  }\n  return {\n    dataConnect: dcInstance,\n    refType: QUERY_STR,\n    name: queryName,\n    variables: variables as Variables\n  };\n}\n/**\n * Converts serialized ref to query ref\n * @param serializedRef ref to convert to `QueryRef`\n * @returns `QueryRef`\n */\nexport function toQueryRef<Data, Variables>(\n  serializedRef: SerializedRef<Data, Variables>\n): QueryRef<Data, Variables> {\n  const {\n    refInfo: { name, variables, connectorConfig }\n  } = serializedRef;\n  return queryRef(getDataConnect(connectorConfig), name, variables);\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport {\n  ConnectorConfig,\n  DataConnect,\n  getDataConnect\n} from '../api/DataConnect';\nimport { Code, DataConnectError } from '../core/error';\ninterface ParsedArgs<Variables> {\n  dc: DataConnect;\n  vars: Variables;\n}\n\n/**\n * The generated SDK will allow the user to pass in either the variable or the data connect instance with the variable,\n * and this function validates the variables and returns back the DataConnect instance and variables based on the arguments passed in.\n * @param connectorConfig\n * @param dcOrVars\n * @param vars\n * @param validateVars\n * @returns {DataConnect} and {Variables} instance\n * @internal\n */\nexport function validateArgs<Variables extends object>(\n  connectorConfig: ConnectorConfig,\n  dcOrVars?: DataConnect | Variables,\n  vars?: Variables,\n  validateVars?: boolean\n): ParsedArgs<Variables> {\n  let dcInstance: DataConnect;\n  let realVars: Variables;\n  if (dcOrVars && 'enableEmulator' in dcOrVars) {\n    dcInstance = dcOrVars as DataConnect;\n    realVars = vars as Variables;\n  } else {\n    dcInstance = getDataConnect(connectorConfig);\n    realVars = dcOrVars as Variables;\n  }\n  if (!dcInstance || (!realVars && validateVars)) {\n    throw new DataConnectError(Code.INVALID_ARGUMENT, 'Variables required.');\n  }\n  return { dc: dcInstance, vars: realVars };\n}\n","/**\n * @license\n * Copyright 2025 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { QueryRef, QueryResult, toQueryRef } from '../../api/query';\nimport { SerializedRef } from '../../api/Reference';\nimport { DataConnectError, Code } from '../error';\n\nimport { getRefSerializer } from './QueryManager';\n\n/**\n * `OnCompleteSubscription`\n */\nexport type OnCompleteSubscription = () => void;\n/**\n * Representation of full observer options in `subscribe`\n */\nexport interface SubscriptionOptions<Data, Variables> {\n  onNext?: OnResultSubscription<Data, Variables>;\n  onErr?: OnErrorSubscription;\n  onComplete?: OnCompleteSubscription;\n}\n\n/**\n * Signature for `OnResultSubscription` for `subscribe`\n */\nexport type OnResultSubscription<Data, Variables> = (\n  res: QueryResult<Data, Variables>\n) => void;\n/**\n * Signature for `OnErrorSubscription` for `subscribe`\n */\nexport type OnErrorSubscription = (err?: DataConnectError) => void;\n/**\n * Signature for unsubscribe from `subscribe`\n */\nexport type QueryUnsubscribe = () => void;\n/**\n * Representation of user provided subscription options.\n */\nexport interface DataConnectSubscription<Data, Variables> {\n  userCallback: OnResultSubscription<Data, Variables>;\n  errCallback?: (e?: DataConnectError) => void;\n  unsubscribe: () => void;\n}\n\n/**\n * Subscribe to a `QueryRef`\n * @param queryRefOrSerializedResult query ref or serialized result.\n * @param observer observer object to use for subscribing.\n * @returns `SubscriptionOptions`\n */\nexport function subscribe<Data, Variables>(\n  queryRefOrSerializedResult:\n    | QueryRef<Data, Variables>\n    | SerializedRef<Data, Variables>,\n  observer: SubscriptionOptions<Data, Variables>\n): QueryUnsubscribe;\n/**\n * Subscribe to a `QueryRef`\n * @param queryRefOrSerializedResult query ref or serialized result.\n * @param onNext Callback to call when result comes back.\n * @param onError Callback to call when error gets thrown.\n * @param onComplete Called when subscription completes.\n * @returns `SubscriptionOptions`\n */\nexport function subscribe<Data, Variables>(\n  queryRefOrSerializedResult:\n    | QueryRef<Data, Variables>\n    | SerializedRef<Data, Variables>,\n  onNext: OnResultSubscription<Data, Variables>,\n  onError?: OnErrorSubscription,\n  onComplete?: OnCompleteSubscription\n): QueryUnsubscribe;\n/**\n * Subscribe to a `QueryRef`\n * @param queryRefOrSerializedResult query ref or serialized result.\n * @param observerOrOnNext observer object or next function.\n * @param onError Callback to call when error gets thrown.\n * @param onComplete Called when subscription completes.\n * @returns `SubscriptionOptions`\n */\nexport function subscribe<Data, Variables>(\n  queryRefOrSerializedResult:\n    | QueryRef<Data, Variables>\n    | SerializedRef<Data, Variables>,\n  observerOrOnNext:\n    | SubscriptionOptions<Data, Variables>\n    | OnResultSubscription<Data, Variables>,\n  onError?: OnErrorSubscription,\n  onComplete?: OnCompleteSubscription\n): QueryUnsubscribe {\n  let ref: QueryRef<Data, Variables>;\n  let initialCache: QueryResult<Data, Variables> | undefined;\n  if ('refInfo' in queryRefOrSerializedResult) {\n    const serializedRef: SerializedRef<Data, Variables> =\n      queryRefOrSerializedResult;\n    const { data, source, fetchTime } = serializedRef;\n\n    ref = toQueryRef(serializedRef);\n    initialCache = {\n      data,\n      source,\n      fetchTime,\n      ref,\n      toJSON: getRefSerializer(ref, data, source, fetchTime)\n    };\n  } else {\n    ref = queryRefOrSerializedResult;\n  }\n  let onResult: OnResultSubscription<Data, Variables> | undefined = undefined;\n  if (typeof observerOrOnNext === 'function') {\n    onResult = observerOrOnNext;\n  } else {\n    onResult = observerOrOnNext.onNext;\n    onError = observerOrOnNext.onErr;\n    onComplete = observerOrOnNext.onComplete;\n  }\n  if (!onResult) {\n    throw new DataConnectError(Code.INVALID_ARGUMENT, 'Must provide onNext');\n  }\n  return ref.dataConnect._queryManager.addSubscription(\n    ref,\n    onResult,\n    onComplete,\n    onError,\n    initialCache\n  );\n}\n","/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n// eslint-disable-next-line import/no-extraneous-dependencies\nimport {\n  _registerComponent,\n  registerVersion,\n  SDK_VERSION\n} from '@firebase/app';\nimport { Component, ComponentType } from '@firebase/component';\n\nimport { name, version } from '../package.json';\nimport { setSDKVersion } from '../src/core/version';\n\nimport { DataConnect, ConnectorConfig } from './api/DataConnect';\nimport { Code, DataConnectError } from './core/error';\n\nexport function registerDataConnect(variant?: string): void {\n  setSDKVersion(SDK_VERSION);\n  _registerComponent(\n    new Component(\n      'data-connect',\n      (container, { instanceIdentifier: connectorConfigStr, options }) => {\n        const app = container.getProvider('app').getImmediate()!;\n        const authProvider = container.getProvider('auth-internal');\n        const appCheckProvider = container.getProvider('app-check-internal');\n        let newOpts = options as ConnectorConfig;\n        if (connectorConfigStr) {\n          newOpts = {\n            ...JSON.parse(connectorConfigStr),\n            ...newOpts\n          };\n        }\n        if (!app.options.projectId) {\n          throw new DataConnectError(\n            Code.INVALID_ARGUMENT,\n            'Project ID must be provided. Did you pass in a proper projectId to initializeApp?'\n          );\n        }\n        return new DataConnect(\n          app,\n          { ...newOpts, projectId: app.options.projectId! },\n          authProvider,\n          appCheckProvider\n        );\n      },\n      ComponentType.PUBLIC\n    ).setMultipleInstances(true)\n  );\n  registerVersion(name, version, variant);\n  // BUILD_TARGET will be replaced by values like esm, cjs, etc during the compilation\n  registerVersion(name, version, '__BUILD_TARGET__');\n}\n","/**\n * Firebase Data Connect\n *\n * @packageDocumentation\n */\n\n/**\n * @license\n * Copyright 2024 Google LLC\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { DataConnect } from './api/DataConnect';\nimport { registerDataConnect } from './register';\n\nexport * from './api';\nexport * from './api.browser';\n\nregisterDataConnect();\n\ndeclare module '@firebase/component' {\n  interface NameServiceMapping {\n    'data-connect': DataConnect;\n  }\n}\n"],"names":["isCloudWorkstation","url","startsWith","URL","hostname","endsWith","emulatorStatus","previouslyDismissed","updateEmulatorBanner","name","isRunningEmulator","window","document","location","host","prefixedId","id","bannerId","showError","getEmulatorSummary","summary","prod","emulator","key","Object","keys","push","length","setupCloseBtn","closeBtn","createElement","style","cursor","marginLeft","fontSize","innerHTML","onclick","tearDown","element","getElementById","remove","setupDom","banner","getOrCreateEl","parentDiv","created","setAttribute","firebaseTextId","firebaseText","learnMoreId","learnMoreLink","prependIconId","prependIcon","createElementNS","bannerEl","setupBannerStyles","display","background","position","bottom","left","padding","borderRadius","alignItems","setupLinkStyles","innerText","href","paddingLeft","textDecoration","setupIconStyles","iconId","append","body","appendChild","readyState","addEventListener","FirebaseError","Error","constructor","code","message","customData","super","this","setPrototypeOf","prototype","captureStackTrace","ErrorFactory","create","service","serviceName","errors","data","fullCode","template","replaceTemplate","replace","PATTERN","_","value","String","fullMessage","Component","instanceFactory","type","multipleInstances","serviceProps","instantiationMode","onInstanceCreated","setInstantiationMode","mode","setMultipleInstances","setServiceProps","props","setInstanceCreatedCallback","callback","LogLevel","levelStringToEnum","debug","DEBUG","verbose","VERBOSE","info","INFO","warn","WARN","error","ERROR","silent","SILENT","defaultLogLevel","ConsoleMethod","defaultLogHandler","instance","logType","args","logLevel","now","Date","toISOString","method","console","SDK_VERSION","Code","OTHER","ALREADY_INITIALIZED","NOT_INITIALIZED","NOT_SUPPORTED","INVALID_ARGUMENT","PARTIAL_ERROR","UNAUTHORIZED","DataConnectError","toString","DataConnectOperationError","response","EntityDataObject","getServerValue","serverValues","globalID","referencedFrom","Set","getServerValues","toJSON","map","Array","from","fromJSON","json","edo","updateServerValue","requestedFrom","add","InMemoryCacheProvider","_keyId","edos","Map","resultTrees","setResultTree","queryId","rt","set","getResultTree","get","updateEntityData","entityData","getEntityData","globalId","has","close","Promise","resolve","GLOBAL_ID_KEY","EntityNode","scalars","references","objectLists","entityDataKeys","loadData","values","entityIds","acc","cacheProvider","undefined","isArray","hasOwnProperty","ids","objArray","scalarArray","index","entries","entityNode","impactedRefs","resultObject","EncodingMode","hydrated","assign","obj","fromJson","sdo","backingData","ResultTree","rootStub","maxAge","cachedAt","lastAccessed","_lastAccessed","isStale","getTime","updateMaxAge","maxAgeInSeconds","updateAccessed","getRootStub","ImpactedQueryRefsAccumulator","impacted","filter","ref","forEach","consumeEvents","events","clear","ResultTreeProcessor","hydrateResults","rootStubObject","dehydrateResults","DataConnectCache","authProvider","projectId","connectorConfig","cacheSettings","uid","addTokenChangeListener","async","newUid","getAuth","getUid","identifier","getIdentifier","initializeNewProviders","initialize","connector","generateSHA256Hash","input","TextEncoder","encode","hashBuffer","crypto","subtle","digest","Uint8Array","b","padStart","join","containsResultTree","getResultJSON","processor","resultTree","update","stubDataObject","maxAgeSeconds","MemoryStub","cacheId","AppCheckTokenProvider","app","appCheckProvider","_isFirebaseServerApp","settings","appCheckToken","serverAppAppCheckToken","appCheck","getImmediate","optional","then","catch","getToken","token","reject","setTimeout","listener","addTokenListener","logger","Logger","_logLevel","_logHandler","_userLogHandler","val","TypeError","setLogLevel","logHandler","userLogHandler","log","logDebug","msg","logError","FirebaseAuthProvider","_appName","_options","_authProvider","_auth","onInit","auth","forceRefresh","JSON","stringify","addAuthTokenListener","removeTokenChangeListener","removeAuthTokenListener","err","QUERY_STR","MUTATION_STR","SOURCE_SERVER","SOURCE_CACHE","populatePath","path","toUpdate","extension","curObj","slice","entityId","entityArr","i","_id","encoderImpl","decoderImpl","sortKeysForObj","o","sort","reduce","accumulator","currentKey","getRefSerializer","queryRef","source","fetchTime","refInfo","variables","dataConnect","options","getSettings","setEncoder","encoder","setDecoder","decoder","s","parse","QueryManager","preferCacheResults","allowStale","cacheResult","fetchCacheResults","e","fetchServerResults","transport","dc","cache","callbacks","subscriptionCache","queue","waitForQueuedWrites","promise","updateSSR","updatedData","updateCache","result","publishCacheResultsToSubscribers","extensions","parseEntityIds","dataConnectExtensions","dataCopy","ret","updatedMaxAge","getMaxAgeFromExtensions","Number","substring","refType","addSubscription","onResultCallback","onCompleteCallback","onErrorCallback","initialCache","unsubscribe","callbackList","subscription","userCallback","errCallback","invokeQuery","originalExtensions","queryResult","updatedKeys","publishDataToSubscribers","publishErrorToSubscribers","getFromResultTreeCache","getFromSubscriberCache","impactedQueries","query","newJson","enableEmulator","port","useEmulator","CallerSdkTypeEnum","Base","Generated","TanstackReactCore","GeneratedReact","TanstackAngularCore","GeneratedAngular","PROD_HOST","addToken","apiKey","newUrl","searchParams","connectFetch","globalThis","fetch","getGoogApiClientValue","_isUsingGen","_callerSdkType","str","toLowerCase","dcFetch","signal","appId","accessToken","_isUsingEmulator","headers","fetchOptions","jsonResponse","credentials","getErrorMessage","status","stringified","failureResponse","RESTTransport","transportOptions","_host","_location","_connectorName","_secure","_project","_accessToken","_appCheckToken","_lastToken","queryName","abortController","AbortController","withRetry","endpointUrl","_serviceName","operationName","invokeMutation","mutationName","_port","sslEnabled","project","urlBuilder","projectConfig","baseUrl","isSecure","onTokenChanged","newToken","getWithAuth","forceToken","starterPromise","_setLastToken","lastToken","promiseFactory","retry","isNewToken","res","_setCallerSdkType","callerSdkType","mutationRef","dcInstance","setInitialized","MutationManager","_transport","_inflight","executeMutation","withRefPromise","toLocaleString","removePromise","_mutationManager","parseOptions","fullHost","protocol","hostName","split","portAsString","DataConnect","dataConnectOptions","_appCheckProvider","isEmulator","_initialized","_isUsingGeneratedSdk","process","env","_transportOptions","getCache","_useGeneratedSdk","_delete","_removeServiceInstance","copy","setCacheSettings","_cacheSettings","_transportClass","_authTokenProvider","_appCheckTokenProvider","_queryManager","areTransportOptionsEqual","transportOptions1","transportOptions2","connectDataConnectEmulator","pingServer","endpoint","ok","getDataConnect","appOrConnectorConfig","settingsOrConnectorConfig","realSettings","getApp","serializedOptions","sortedSerialized","fromEntries","provider","_getProvider","isInitialized","getOptions","validateDCOptions","instanceIdentifier","dcOptions","field","terminate","StorageType","MEMORY","makeMemoryCacheProvider","QueryFetchPolicy","PREFER_CACHE","CACHE_ONLY","SERVER_ONLY","executeQuery","queryManager","fetchPolicy","toQueryRef","serializedRef","validateArgs","dcOrVars","vars","validateVars","realVars","subscribe","queryRefOrSerializedResult","observerOrOnNext","onError","onComplete","onResult","onNext","onErr","registerDataConnect","variant","setSDKVersion","version","_registerComponent","container","connectorConfigStr","getProvider","newOpts","registerVersion"],"mappings":"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","preExistingComment":"firebase-data-connect.js.map"}